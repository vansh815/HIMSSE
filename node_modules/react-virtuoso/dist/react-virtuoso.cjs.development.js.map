{"version":3,"file":"react-virtuoso.cjs.development.js","sources":["../src/VirtuosoContext.tsx","../src/tinyrx.ts","../src/EngineCommons.ts","../src/engines/adjustForPrependedItemsEngine.ts","../src/engines/followOutputEngine.ts","../src/AATree.ts","../src/GroupIndexTransposer.ts","../src/engines/groupCountEgine.ts","../src/engines/listEngine.ts","../src/engines/maxRangeSizeEngine.ts","../src/OffsetList.ts","../src/engines/initialItemCountEngine.ts","../src/engines/stickyItemsEngine.ts","../src/engines/offsetListEngine.ts","../src/engines/scrolledToBottomEngine.ts","../src/engines/scrollSeekEngine.ts","../src/engines/initialTopMostItemEngine.ts","../src/engines/scrollToIndexEngine.ts","../src/engines/topItemCountEngine.ts","../src/engines/topListEngine.ts","../src/rxio.ts","../src/VirtuosoStore.tsx","../src/Style.tsx","../src/Utils.tsx","../src/VirtuosoFiller.tsx","../src/VirtuosoList.tsx","../src/VirtuosoScroller.tsx","../src/VirtuosoView.tsx","../src/Virtuoso.tsx","../src/GroupedVirtuoso.tsx","../src/VirtuosoGridEngine.ts","../src/VirtuosoGrid.tsx"],"sourcesContent":["import { createContext } from 'react'\nimport { VirtuosoStore } from './VirtuosoStore'\n\nexport const VirtuosoContext = createContext<ReturnType<typeof VirtuosoStore> | undefined>(undefined)\n","export type TSubscriber<T> = (val: T) => void\nexport type TSubscription = () => void\nexport type TSubscribe<T> = (subscriber: TSubscriber<T>) => TSubscription\nexport type TOperator<T, K> = (val: T, done: (result: K) => void) => void\n\nexport interface TObservable<T> {\n  subscribe: TSubscribe<T>\n  pipe(...operators: []): TObservable<T>\n  pipe<R1>(...operators: [TOperator<T, R1>]): TObservable<R1>\n  pipe<R1, R2>(...operators: [TOperator<T, R1>, TOperator<R1, R2>]): TObservable<R2>\n  pipe<R1, R2, R3>(...operators: [TOperator<T, R1>, TOperator<R1, R2>, TOperator<R2, R3>]): TObservable<R3>\n  pipe<R1, R2, R3, R4>(\n    ...operators: [TOperator<T, R1>, TOperator<R1, R2>, TOperator<R2, R3>, TOperator<R3, R4>]\n  ): TObservable<R4>\n}\n\nexport interface TSubject<T> extends TObservable<T> {\n  next(val: T): void\n  subscribers: TSubscriber<T>[]\n}\n\nfunction combineOperators<A1>(): TOperator<A1, A1>\nfunction combineOperators<A1, R1>(o1: TOperator<A1, R1>): TOperator<A1, R1>\nfunction combineOperators<A1, R1, R2>(o1: TOperator<A1, R1>, o2: TOperator<R1, R2>): TOperator<A1, R2>\nfunction combineOperators<A1, R1, R2>(o1: TOperator<A1, R1>, o2: TOperator<R1, R2>): TOperator<A1, R2>\nfunction combineOperators<A1, R1, R2, R3>(\n  o1: TOperator<A1, R1>,\n  o2: TOperator<R1, R2>,\n  o3: TOperator<R2, R3>\n): TOperator<A1, R3>\nfunction combineOperators<A1, R1, R2, R3, R4>(\n  o1: TOperator<A1, R1>,\n  o2: TOperator<R1, R2>,\n  o3: TOperator<R2, R3>,\n  o4: TOperator<R3, R4>\n): TOperator<A1, R4>\nfunction combineOperators<T>(...operators: TOperator<any, any>[]): TOperator<T, any>\nfunction combineOperators<T, K>(...operators: TOperator<any, any>[]) {\n  if (operators.length === 0) {\n    return (value: T, subscriber: (value: T) => void) => subscriber(value)\n  }\n  if (operators.length === 1) {\n    return operators[0]\n  }\n\n  return (value: T, subscriber: (value: K) => void): void => {\n    let acc = (value: any) => subscriber(value)\n    operators\n      .slice()\n      .reverse()\n      .forEach(operator => {\n        const prevCallback = acc\n        acc = value => operator(value, prevCallback)\n      })\n    acc(value)\n  }\n}\n\nfunction buildPipe<T>(subscribe: TSubscribe<T>) {\n  function pipe(...operators: []): TObservable<T>\n  function pipe<R1>(...operators: [TOperator<T, R1>]): TObservable<R1>\n  function pipe<R1, R2>(...operators: [TOperator<T, R1>, TOperator<R1, R2>]): TObservable<R2>\n  function pipe<R1, R2, R3>(...operators: [TOperator<T, R1>, TOperator<R1, R2>, TOperator<R2, R3>]): TObservable<R3>\n  function pipe<R1, R2, R3, R4>(\n    ...operators: [TOperator<T, R1>, TOperator<R1, R2>, TOperator<R2, R3>, TOperator<R3, R4>]\n  ): TObservable<R4>\n  function pipe<K extends TOperator<any, any>[]>(...operators: K) {\n    const operator = combineOperators(...operators)\n    return observable(subscribe, operator)\n  }\n  return pipe\n}\n\nexport function observable<T, K>(source: TSubscribe<T>, operator: TOperator<T, K>) {\n  const subscribe = (subscriber: TSubscriber<K>) => {\n    return source(val => operator(val, subscriber))\n  }\n\n  return {\n    subscribe,\n    pipe: buildPipe(subscribe),\n  }\n}\n\nexport function subject<T>(initial?: T, distinct = true): TSubject<T> {\n  let subscribers: TSubscriber<T>[] = []\n  let val: T | undefined = initial\n\n  const next = (newVal: T) => {\n    if (!distinct || newVal !== val) {\n      val = newVal\n      subscribers.forEach(subscriber => subscriber(newVal))\n    }\n  }\n\n  const subscribe = (subscriber: TSubscriber<T>) => {\n    subscribers.push(subscriber)\n    if (val !== undefined) {\n      subscriber(val)\n    }\n    return () => {\n      subscribers = subscribers.filter(sub => sub !== subscriber)\n    }\n  }\n\n  return {\n    next,\n    subscribe,\n    pipe: buildPipe(subscribe),\n    subscribers,\n  }\n}\n\nexport function coldSubject<T>(): TSubject<T> {\n  let subscribers: TSubscriber<T>[] = []\n\n  const next = (newVal: T) => {\n    subscribers.forEach(subscriber => subscriber(newVal))\n  }\n\n  const subscribe = (subscriber: TSubscriber<T>) => {\n    subscribers.push(subscriber)\n    return () => {\n      subscribers = subscribers.filter(sub => sub !== subscriber)\n    }\n  }\n\n  return {\n    next,\n    subscribe,\n    pipe: buildPipe(subscribe),\n    subscribers,\n  }\n}\n\nexport function combineLatest<S1, S2>(s1: TObservable<S1>, s2: TObservable<S2>): TObservable<[S1, S2]>\nexport function combineLatest<S1, S2, S3>(\n  s1: TObservable<S1>,\n  s2: TObservable<S2>,\n  s3: TObservable<S3>\n): TObservable<[S1, S2, S3]>\nexport function combineLatest<S1, S2, S3, S4>(\n  s1: TObservable<S1>,\n  s2: TObservable<S2>,\n  s3: TObservable<S3>,\n  s4: TObservable<S4>\n): TObservable<[S1, S2, S3, S4]>\nexport function combineLatest<S1, S2, S3, S4, S5>(\n  s1: TObservable<S1>,\n  s2: TObservable<S2>,\n  s3: TObservable<S3>,\n  s4: TObservable<S4>,\n  s5: TObservable<S5>\n): TObservable<[S1, S2, S3, S4, S5]>\nexport function combineLatest<S1, S2, S3, S4, S5, S6>(\n  ...s: [TObservable<S1>, TObservable<S2>, TObservable<S3>, TObservable<S4>, TObservable<S5>, TObservable<S6>]\n): TObservable<[S1, S2, S3, S4, S5, S6]>\nexport function combineLatest<S1, S2, S3, S4, S5, S6, S7>(\n  s1: TObservable<S1>,\n  s2: TObservable<S2>,\n  s3: TObservable<S3>,\n  s4: TObservable<S4>,\n  s5: TObservable<S5>,\n  s6: TObservable<S6>,\n  s7: TObservable<S7>\n): TObservable<[S1, S2, S3, S4, S5, S6, S7]>\nexport function combineLatest<S1, S2, S3, S4, S5, S6, S7, S8>(\n  s1: TObservable<S1>,\n  s2: TObservable<S2>,\n  s3: TObservable<S3>,\n  s4: TObservable<S4>,\n  s5: TObservable<S5>,\n  s6: TObservable<S6>,\n  s7: TObservable<S7>,\n  s8: TObservable<S8>\n): TObservable<[S1, S2, S3, S4, S5, S6, S7, S8]>\nexport function combineLatest<S1, S2, S3, S4, S5, S6, S7, S8, S9>(\n  s1: TObservable<S1>,\n  s2: TObservable<S2>,\n  s3: TObservable<S3>,\n  s4: TObservable<S4>,\n  s5: TObservable<S5>,\n  s6: TObservable<S6>,\n  s7: TObservable<S7>,\n  s8: TObservable<S8>,\n  s9: TObservable<S9>\n): TObservable<[S1, S2, S3, S4, S5, S6, S7, S8, S9]>\nexport function combineLatest<S1, S2, S3, S4, S5, S6, S7, S8, S9, S10>(\n  s1: TObservable<S1>,\n  s2: TObservable<S2>,\n  s3: TObservable<S3>,\n  s4: TObservable<S4>,\n  s5: TObservable<S5>,\n  s6: TObservable<S6>,\n  s7: TObservable<S7>,\n  s8: TObservable<S8>,\n  s9: TObservable<S9>,\n  s10: TObservable<S10>\n): TObservable<[S1, S2, S3, S4, S5, S6, S7, S8, S9, S10]>\nexport function combineLatest<S1, S2, S3, S4, S5, S6, S7, S8, S9, S10, S11>(\n  s1: TObservable<S1>,\n  s2: TObservable<S2>,\n  s3: TObservable<S3>,\n  s4: TObservable<S4>,\n  s5: TObservable<S5>,\n  s6: TObservable<S6>,\n  s7: TObservable<S7>,\n  s8: TObservable<S8>,\n  s9: TObservable<S9>,\n  s10: TObservable<S10>,\n  s11: TObservable<S11>\n): TObservable<[S1, S2, S3, S4, S5, S6, S7, S8, S9, S10, S11]>\nexport function combineLatest(...sources: TObservable<any>[]): TObservable<any[]> {\n  const called = Array<boolean>(sources.length).fill(false)\n  const values = Array<any>(sources.length)\n  let subscribers: TSubscriber<any>[] = []\n\n  const publish = (subscribers: TSubscriber<any>[]) => {\n    called.every(isCalled => isCalled) && subscribers.forEach(subscriber => subscriber(values))\n  }\n\n  sources.forEach((source, index) => {\n    source.subscribe(val => {\n      called[index] = true\n      values[index] = val\n      publish(subscribers)\n    })\n  })\n\n  const subscribe = (subscriber: TSubscriber<any[]>) => {\n    subscribers.push(subscriber)\n    publish([subscriber])\n    return () => {\n      subscribers = subscribers.filter(sub => sub !== subscriber)\n    }\n  }\n\n  return { subscribe, pipe: buildPipe(subscribe) }\n}\n\nexport function map<T, K>(map: (val: T) => K): (val: T, subscriber: TSubscriber<K>) => void {\n  return (val: T, subscriber: TSubscriber<K>) => {\n    subscriber(map(val))\n  }\n}\n\nexport function mapTo<T>(val: T) {\n  return (_: any, done: TSubscriber<T>) => done(val)\n}\n\nexport function skip<T>(times: number) {\n  return (val: T, done: TSubscriber<T>) => {\n    if (times > 0) {\n      times--\n    } else {\n      done(val)\n    }\n  }\n}\n\nexport function filter<T>(predicate: (val: T) => boolean) {\n  return (val: T, done: TSubscriber<T>) => {\n    predicate(val) && done(val)\n  }\n}\n\nexport function duc<T>(comparator = (current: T, next: T) => current !== next) {\n  let current: T\n  return (next: T, done: TSubscriber<T>) => {\n    if (comparator(current, next)) {\n      current = next\n      done(next)\n    }\n  }\n}\n\nexport function debounceTime<T>(time: number) {\n  let val: T | undefined\n  let timeout: any\n\n  return (newVal: T, done: TSubscriber<T>) => {\n    val = newVal\n    if (timeout) {\n      clearTimeout(timeout)\n    }\n\n    timeout = setTimeout(() => {\n      done(val!)\n    }, time)\n  }\n}\n\nexport function throttleTime<T>(time: number) {\n  let val: T | undefined\n  let timeout: any\n\n  return (newVal: T, done: TSubscriber<T>) => {\n    val = newVal\n\n    if (timeout) {\n      return\n    }\n\n    timeout = setTimeout(() => {\n      timeout = undefined\n      done(val!)\n    }, time)\n  }\n}\n\nexport function scan<T, K>(scanner: (prevVal: T, current: K) => T, initialValue: T) {\n  let prevVal: T = initialValue\n  return (newVal: K, done: TSubscriber<T>) => {\n    done((prevVal = scanner(prevVal, newVal)))\n  }\n}\n\nexport function withLatestFrom<T, R1>(s1: TObservable<R1>): (val: T, done: TSubscriber<[T, R1]>) => void\nexport function withLatestFrom<T, R1, R2>(\n  s1: TObservable<R1>,\n  s2: TObservable<R2>\n): (val: T, done: TSubscriber<[T, R1, R2]>) => void\nexport function withLatestFrom<T, R1, R2, R3>(\n  s1: TObservable<R1>,\n  s2: TObservable<R2>,\n  s3: TObservable<R3>\n): (val: T, done: TSubscriber<[T, R1, R2, R3]>) => void\nexport function withLatestFrom<T, R1, R2, R3, R4>(\n  s1: TObservable<R1>,\n  s2: TObservable<R2>,\n  s3: TObservable<R3>,\n  s4: TObservable<R4>\n): (val: T, done: TSubscriber<[T, R1, R2, R3, R4]>) => void\nexport function withLatestFrom<T, R1, R2, R3, R4, R5>(\n  s1: TObservable<R1>,\n  s2: TObservable<R2>,\n  s3: TObservable<R3>,\n  s4: TObservable<R4>,\n  s5: TObservable<R5>\n): (val: T, done: TSubscriber<[T, R1, R2, R3, R4, R5]>) => void\nexport function withLatestFrom<T, R1, R2, R3, R4, R5, R6>(\n  s1: TObservable<R1>,\n  s2: TObservable<R2>,\n  s3: TObservable<R3>,\n  s4: TObservable<R4>,\n  s5: TObservable<R5>,\n  s6: TObservable<R6>\n): (val: T, done: TSubscriber<[T, R1, R2, R3, R4, R5, R6]>) => void\nexport function withLatestFrom<T, R1, R2, R3, R4, R5, R6, R7>(\n  s1: TObservable<R1>,\n  s2: TObservable<R2>,\n  s3: TObservable<R3>,\n  s4: TObservable<R4>,\n  s5: TObservable<R5>,\n  s6: TObservable<R6>,\n  s7: TObservable<R7>\n): (val: T, done: TSubscriber<[T, R1, R2, R3, R4, R5, R6, R7]>) => void\n\nexport function withLatestFrom<T>(...sources: TObservable<any>[]) {\n  const called = Array<boolean>(sources.length).fill(false)\n  const values = Array<any>(sources.length)\n  sources.forEach((source, index) => {\n    source.subscribe(val => {\n      values[index] = val\n      called[index] = true\n    })\n  })\n\n  return (val: T, done: TSubscriber<any>) => {\n    called.every(isCalled => isCalled) && done([val, ...values])\n  }\n}\n","import * as React from 'react'\nimport { debounceTime, mapTo, skip, subject, TObservable, duc } from './tinyrx'\n\ninterface TScrollLocationWithAlign {\n  index: number\n  align: 'start' | 'center' | 'end'\n  behavior?: 'smooth' | 'auto'\n}\n\nexport type TScrollLocation = number | TScrollLocationWithAlign\n\nexport type TContainer =\n  | React.ComponentType<{ className: string; style?: React.CSSProperties; key?: number }>\n  | keyof JSX.IntrinsicElements\n\nexport const buildIsScrolling = (scrollTop$: TObservable<number>): TObservable<boolean> => {\n  const isScrolling$ = subject(false)\n\n  scrollTop$.pipe(skip(1), duc(), mapTo(true)).subscribe(isScrolling$.next)\n\n  scrollTop$.pipe(skip(1), mapTo(false), debounceTime(200)).subscribe(isScrolling$.next)\n\n  return isScrolling$\n}\n","import { TObservable, withLatestFrom, coldSubject, TSubject, subject } from '../tinyrx'\nimport { OffsetList } from '../OffsetList'\n\ninterface AdjustForPrependedItemsParams {\n  offsetList$: TSubject<OffsetList>\n  scrollTop$: TObservable<number>\n  scrollTo$: TSubject<ScrollToOptions>\n}\n\nexport function adjustForPrependedItemsEngine({ offsetList$, scrollTop$, scrollTo$ }: AdjustForPrependedItemsParams) {\n  const adjustForPrependedItems$ = coldSubject<number>()\n\n  const adjustmentInProgress$ = subject(false)\n  adjustForPrependedItems$\n    .pipe(withLatestFrom(offsetList$, scrollTop$, adjustmentInProgress$))\n    .subscribe(([count, offsetList, scrollTop, inProgress]) => {\n      if (inProgress || offsetList.empty()) {\n        return\n      }\n\n      adjustmentInProgress$.next(true)\n      offsetList$.next(offsetList.adjustForPrependedItems(count))\n\n      setTimeout(() => {\n        scrollTo$.next({ top: count * offsetList.getDefaultSize() + scrollTop })\n        adjustmentInProgress$.next(false)\n      })\n    })\n\n  return { adjustForPrependedItems$, adjustmentInProgress$ }\n}\n","import { TScrollLocation } from '../EngineCommons'\nimport { TObservable, TSubject, subject, combineLatest, withLatestFrom } from '../tinyrx'\n\ninterface FollowOutputParams {\n  totalCount$: TObservable<number>\n  scrolledToBottom$: TSubject<boolean>\n  scrollToIndex$: TSubject<TScrollLocation>\n}\nexport function followOutputEngine({ scrollToIndex$, scrolledToBottom$, totalCount$ }: FollowOutputParams) {\n  const followOutput$ = subject(false)\n\n  combineLatest(followOutput$, totalCount$)\n    .pipe(withLatestFrom(scrolledToBottom$))\n    .subscribe(([[followOutput, totalCount], scrolledToBottom]) => {\n      if (followOutput && scrolledToBottom) {\n        setTimeout(() => {\n          scrollToIndex$.next({ index: totalCount - 1, align: 'end', behavior: 'auto' })\n        })\n      }\n    })\n  return {\n    followOutput$,\n  }\n}\n","interface NodeData<T> {\n  key: number\n  value: T\n}\n\ninterface Range<T> {\n  start: number\n  end: number\n  value: T\n}\n\ntype FindCallback<T> = (value: T) => 1 | 0 | -1\n\nexport type NodeIterator<T> = IterableIterator<NodeData<T>>\nexport type RangeIterator<T> = IterableIterator<Range<T>>\n\nclass NilNode<T> {\n  public level = 0\n\n  public rebalance(): this {\n    return this\n  }\n\n  public adjust(): this {\n    return this\n  }\n\n  public shift(): this {\n    return this\n  }\n\n  public remove(): this {\n    return this\n  }\n\n  public find(): undefined {\n    return\n  }\n\n  public findWith(): undefined {\n    return\n  }\n\n  public findMax(): number {\n    return -Infinity\n  }\n\n  public findMaxValue(): undefined {\n    return\n  }\n\n  public insert(key: number, value: T): NonNilNode<T> {\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    return new NonNilNode<T>({ key, value, level: 1 })\n  }\n\n  public walkWithin(): NodeData<T>[] {\n    return []\n  }\n\n  public walk(): NodeData<T>[] {\n    return []\n  }\n\n  public ranges<T>(): Range<T>[] {\n    return []\n  }\n\n  public rangesWithin<T>(): Range<T>[] {\n    return []\n  }\n\n  public empty(): this is NilNode<T> {\n    return true\n  }\n\n  public isSingle(): true {\n    return true\n  }\n\n  public isInvariant(): true {\n    return true\n  }\n\n  public keys(): number[] {\n    return []\n  }\n}\n\nconst NIL_NODE = new NilNode()\n\nObject.freeze(NIL_NODE)\n\ntype Node<T> = NonNilNode<T> | NilNode<T>\n\ninterface NodeConstructorArgs<T> {\n  key: number\n  value: T\n  level: number\n  left?: Node<T>\n  right?: Node<T>\n}\n\nclass UnreachableCaseError extends Error {\n  constructor(val: never) {\n    super(`Unreachable case: ${val}`)\n  }\n}\n\nclass NonNilNode<T> {\n  public key: number\n  public value: T\n  public level: number\n  public left: Node<T>\n  public right: Node<T>\n\n  public constructor({\n    key,\n    value,\n    level,\n    left = NIL_NODE as NilNode<T>,\n    right = NIL_NODE as NilNode<T>,\n  }: NodeConstructorArgs<T>) {\n    this.key = key\n    this.value = value\n    this.level = level\n    this.left = left\n    this.right = right\n  }\n\n  public shift(amount: number): Node<T> {\n    return this.clone({\n      key: this.key + amount,\n      left: this.left.shift(amount),\n      right: this.right.shift(amount),\n    })\n  }\n\n  public remove(key: number): Node<T> {\n    const { left, right } = this\n\n    if (key === this.key) {\n      if (left.empty()) {\n        return right\n      } else if (right.empty()) {\n        return left\n      } else {\n        const [lastKey, lastValue] = left.last()\n        return this.clone({\n          key: lastKey,\n          value: lastValue,\n          left: left.deleteLast(),\n        }).adjust()\n      }\n    } else if (key < this.key) {\n      return this.clone({\n        left: left.remove(key),\n      }).adjust()\n    } else {\n      return this.clone({\n        right: right.remove(key),\n      }).adjust()\n    }\n  }\n\n  public empty(): this is NilNode<T> {\n    return false\n  }\n\n  public find(key: number): T | undefined {\n    if (key === this.key) {\n      return this.value\n    } else if (key < this.key) {\n      return this.left.find(key)\n    } else {\n      return this.right.find(key)\n    }\n  }\n\n  public findWith(callback: FindCallback<T>): [number, T] | undefined {\n    const result = callback(this.value)\n\n    switch (result) {\n      case -1:\n        return this.left.findWith(callback)\n      case 0:\n        return [this.key, this.value]\n      case 1:\n        return this.right.findWith(callback)\n      default:\n        throw new UnreachableCaseError(result)\n    }\n  }\n\n  public findMax(key: number): number {\n    if (this.key === key) {\n      return key\n    }\n\n    if (this.key < key) {\n      const rightKey = this.right.findMax(key)\n      if (rightKey === -Infinity) {\n        return this.key\n      } else {\n        return rightKey\n      }\n    }\n\n    return this.left.findMax(key)\n  }\n\n  public findMaxValue(key: number): T {\n    if (this.key === key) {\n      return this.value\n    }\n\n    if (this.key < key) {\n      const rightValue = this.right.findMaxValue(key)\n      if (rightValue === undefined) {\n        return this.value\n      } else {\n        return rightValue\n      }\n    }\n\n    return this.left.findMaxValue(key)!\n  }\n\n  public insert(key: number, value: T): NonNilNode<T> {\n    if (key === this.key) {\n      return this.clone({ key, value })\n    } else if (key < this.key) {\n      return this.clone({\n        left: this.left.insert(key, value),\n      }).rebalance()\n    } else {\n      return this.clone({\n        right: this.right.insert(key, value),\n      }).rebalance()\n    }\n  }\n\n  public walkWithin(start: number, end: number): NodeData<T>[] {\n    const { key, value } = this\n    let result: NodeData<T>[] = []\n    if (key > start) {\n      result = result.concat(this.left.walkWithin(start, end))\n    }\n\n    if (key >= start && key <= end) {\n      result.push({ key, value })\n    }\n\n    if (key <= end) {\n      result = result.concat(this.right.walkWithin(start, end))\n    }\n\n    return result\n  }\n\n  public walk(): NodeData<T>[] {\n    return [...this.left.walk(), { key: this.key, value: this.value }, ...this.right.walk()]\n  }\n\n  public last(): [number, T] {\n    if (this.right.empty()) {\n      return [this.key, this.value]\n    } else {\n      return this.right.last()\n    }\n  }\n\n  public deleteLast(): Node<T> {\n    if (this.right.empty()) {\n      return this.left\n    } else {\n      return this.clone({\n        right: this.right.deleteLast(),\n      }).adjust()\n    }\n  }\n\n  public clone(args: Partial<NodeConstructorArgs<T>>): NonNilNode<T> {\n    return new NonNilNode<T>({\n      key: args.key !== undefined ? args.key : this.key,\n      value: args.value !== undefined ? args.value : this.value,\n      level: args.level !== undefined ? args.level : this.level,\n      left: args.left !== undefined ? args.left : this.left,\n      right: args.right !== undefined ? args.right : this.right,\n    })\n  }\n\n  public isSingle(): boolean {\n    return this.level > this.right.level\n  }\n\n  public rebalance(): NonNilNode<T> {\n    return this.skew().split()\n  }\n\n  public adjust(): NonNilNode<T> {\n    const { left, right, level } = this\n    if (right.level >= level - 1 && left.level >= level - 1) {\n      return this\n    } else if (level > right.level + 1) {\n      if (left.isSingle()) {\n        return this.clone({ level: level - 1 }).skew()\n      } else {\n        if (!left.empty() && !left.right.empty()) {\n          return left.right.clone({\n            left: left.clone({ right: left.right.left }),\n            right: this.clone({\n              left: left.right.right,\n              level: level - 1,\n            }),\n            level: level,\n          })\n        } else {\n          throw new Error('Unexpected empty nodes')\n        }\n      }\n    } else {\n      if (this.isSingle()) {\n        return this.clone({ level: level - 1 }).split()\n      } else {\n        if (!right.empty() && !right.left.empty()) {\n          const rl = right.left\n          const rightLevel = rl.isSingle() ? right.level - 1 : right.level\n\n          return rl.clone({\n            left: this.clone({\n              right: rl.left,\n              level: level - 1,\n            }),\n            right: right.clone({ left: rl.right, level: rightLevel }).split(),\n            level: rl.level + 1,\n          })\n        } else {\n          throw new Error('Unexpected empty nodes')\n        }\n      }\n    }\n  }\n\n  public isInvariant(): boolean {\n    const { left, right, level } = this\n\n    if (level !== left.level + 1) {\n      return false\n    } else if (level !== right.level && level !== right.level + 1) {\n      return false\n    } else if (!right.empty() && level <= right.right.level) {\n      return false\n    } else {\n      return left.isInvariant() && right.isInvariant()\n    }\n  }\n\n  public keys(): number[] {\n    return [...this.left.keys(), this.key, ...this.right.keys()]\n  }\n\n  public ranges(): Range<T>[] {\n    return this.toRanges(this.walk())\n  }\n\n  public rangesWithin(startIndex: number, endIndex: number): Range<T>[] {\n    return this.toRanges(this.walkWithin(startIndex, endIndex))\n  }\n\n  private toRanges(nodes: NodeData<T>[]): Range<T>[] {\n    if (nodes.length === 0) {\n      return []\n    }\n\n    const first = nodes[0]\n\n    let { key: start, value } = first\n\n    const result = []\n\n    for (let i = 1; i <= nodes.length; i++) {\n      const nextNode = nodes[i]\n      const end = nextNode ? nextNode.key - 1 : Infinity\n      result.push({ start, end, value })\n\n      if (nextNode) {\n        start = nextNode.key\n        value = nextNode.value\n      }\n    }\n    return result\n  }\n\n  private split(): NonNilNode<T> {\n    const { right, level } = this\n    if (!right.empty() && !right.right.empty() && right.level === level && right.right.level === level) {\n      return right.clone({\n        left: this.clone({ right: right.left }),\n        level: level + 1,\n      })\n    } else {\n      return this\n    }\n  }\n\n  private skew(): NonNilNode<T> {\n    const { left } = this\n\n    if (!left.empty() && left.level === this.level) {\n      return left.clone({\n        right: this.clone({ left: left.right }),\n      })\n    } else {\n      return this\n    }\n  }\n}\n\nexport class AATree<T> {\n  private root: Node<T>\n\n  public static empty<T>(): AATree<T> {\n    return new AATree<T>(NIL_NODE as NilNode<T>)\n  }\n\n  private constructor(root: Node<T>) {\n    this.root = root\n  }\n\n  public find(key: number): T | undefined {\n    return this.root.find(key)\n  }\n\n  public findMax(key: number): number {\n    return this.root.findMax(key)\n  }\n\n  public findMaxValue(key: number): T {\n    if (this.empty()) {\n      throw new Error('Searching for max value in an empty tree')\n    }\n    return this.root.findMaxValue(key)!\n  }\n\n  public findWith(callback: FindCallback<T>): [number, T] | void {\n    return this.root.findWith(callback)\n  }\n\n  public insert(key: number, value: T): AATree<T> {\n    return new AATree(this.root.insert(key, value))\n  }\n\n  public remove(key: number): AATree<T> {\n    return new AATree(this.root.remove(key))\n  }\n\n  public shift(amount: number) {\n    if (this.empty()) {\n      return this\n    }\n    const defaultValue = this.root.findMaxValue(Infinity)\n    return new AATree(this.root.shift(amount).insert(0, defaultValue!))\n  }\n\n  public empty() {\n    return this.root.empty()\n  }\n\n  public keys(): number[] {\n    return this.root.keys()\n  }\n\n  public walk(): NodeData<T>[] {\n    return this.root.walk()\n  }\n\n  public walkWithin(start: number, end: number): NodeData<T>[] {\n    const adjustedStart = this.root.findMax(start)\n    return this.root.walkWithin(adjustedStart, end)\n  }\n\n  public ranges(): Range<T>[] {\n    return this.root.ranges()\n  }\n\n  public rangesWithin(start: number, end: number): Range<T>[] {\n    const adjustedStart = this.root.findMax(start)\n    return this.root.rangesWithin(adjustedStart, end)\n  }\n\n  public isInvariant(): boolean {\n    return this.root.isInvariant()\n  }\n}\n","import { AATree } from './AATree'\nimport { Item } from './OffsetList'\n\nexport interface RecordItem extends Item {\n  type: 'item'\n  transposedIndex: number\n  groupIndex: number\n}\n\nexport interface GroupItem extends Item {\n  type: 'group'\n  groupIndex: number\n}\n\nexport type ListItem = RecordItem | GroupItem\n\nexport class StubIndexTransposer {\n  public transpose(items: Item[]): RecordItem[] {\n    return items.map(item => {\n      return {\n        groupIndex: 0,\n        index: item.index,\n        offset: item.offset,\n        size: item.size,\n        transposedIndex: item.index,\n        type: 'item',\n      }\n    })\n  }\n}\n\nexport class GroupIndexTransposer {\n  public tree: AATree<[number, number]>\n  private count: number\n\n  public constructor(counts: number[]) {\n    this.count = counts.reduce((acc, groupCount) => acc + groupCount + 1, 0)\n    let tree = AATree.empty<[number, number]>()\n    let groupIndex = 0\n    let total = 0\n    for (const groupCount of counts) {\n      tree = tree.insert(total, [groupIndex, total])\n      groupIndex++\n      total += groupCount + 1\n    }\n    this.tree = tree\n  }\n\n  public totalCount(): number {\n    return this.count\n  }\n\n  public transpose(items: Item[]): ListItem[] {\n    return items.map(item => {\n      const groupMatch = this.tree.find(item.index)\n      if (groupMatch) {\n        return {\n          groupIndex: groupMatch[0],\n          index: item.index,\n          offset: item.offset,\n          size: item.size,\n          type: 'group',\n        }\n      }\n\n      const [groupIndex] = this.tree.findMaxValue(item.index)!\n      return {\n        groupIndex: groupIndex,\n        index: item.index,\n        offset: item.offset,\n        size: item.size,\n        transposedIndex: item.index - groupIndex - 1,\n        type: 'item',\n      }\n    })\n  }\n\n  public groupIndices() {\n    return this.tree.keys()\n  }\n}\n\nexport type Transposer = StubIndexTransposer | GroupIndexTransposer\n","import { GroupIndexTransposer, Transposer } from '../GroupIndexTransposer'\nimport { TSubject, subject } from '../tinyrx'\n\ninterface GroupCountParams {\n  totalCount$: TSubject<number>\n  stickyItems$: TSubject<number[]>\n  transposer$: TSubject<Transposer>\n}\nexport function groupCountEngine({ transposer$, stickyItems$, totalCount$ }: GroupCountParams) {\n  const groupCounts$ = subject<number[]>()\n  const groupIndices$ = stickyItems$.pipe()\n\n  groupCounts$.subscribe(counts => {\n    const transposer = new GroupIndexTransposer(counts)\n    transposer$.next(transposer)\n    totalCount$.next(transposer.totalCount())\n    stickyItems$.next(transposer.groupIndices())\n  })\n\n  return {\n    groupCounts$,\n    groupIndices$,\n  }\n}\n","import { scan, combineLatest, TObservable, map, subject, withLatestFrom, coldSubject, duc } from '../tinyrx'\nimport { OffsetList } from '../OffsetList'\nimport { ListItem, Transposer } from '../GroupIndexTransposer'\n\nexport const getListTop = (items: ListItem[]) => (items.length > 0 ? items[0].offset : 0)\n\ninterface ListEngineParams {\n  overscan: number\n  defaultItemHeight?: number\n  viewportHeight$: TObservable<number>\n  scrollTop$: TObservable<number>\n  topListHeight$: TObservable<number>\n  headerHeight$: TObservable<number>\n  footerHeight$: TObservable<number>\n  minListIndex$: TObservable<number>\n  totalCount$: TObservable<number>\n  offsetList$: TObservable<OffsetList>\n  scrolledToTopMostItem$: TObservable<boolean>\n  transposer$: TObservable<Transposer>\n  totalHeight$: TObservable<number>\n}\n\nexport function listEngine({\n  overscan,\n  defaultItemHeight,\n  viewportHeight$,\n  scrollTop$,\n  topListHeight$,\n  headerHeight$,\n  footerHeight$,\n  minListIndex$,\n  totalCount$,\n  offsetList$,\n  scrolledToTopMostItem$,\n  transposer$,\n  totalHeight$,\n}: ListEngineParams) {\n  const listHeight$ = subject(0)\n  const startReached$ = coldSubject<number>()\n  const endReached$ = coldSubject<number>()\n  const list$ = subject<ListItem[]>([])\n\n  const constrainedScrollTop$ = subject(0)\n\n  combineLatest(scrollTop$, totalHeight$, viewportHeight$)\n    .pipe(\n      map(([scrollTop, totalHeight, viewportHeight]) => Math.max(0, Math.min(scrollTop, totalHeight - viewportHeight)))\n    )\n    .subscribe(constrainedScrollTop$.next)\n\n  combineLatest(\n    viewportHeight$,\n    constrainedScrollTop$,\n    topListHeight$,\n    listHeight$,\n    headerHeight$,\n    footerHeight$,\n    minListIndex$,\n    totalCount$,\n    offsetList$,\n    scrolledToTopMostItem$,\n    transposer$\n  )\n    .pipe(\n      scan(\n        (\n          items,\n          [\n            viewportHeight,\n            scrollTop,\n            topListHeight,\n            listHeight,\n            headerHeight,\n            footerHeight,\n            minIndex,\n            totalCount,\n            offsetList,\n            scrolledToTopMostItem,\n            transposer,\n          ]\n        ) => {\n          const itemLength = items.length\n\n          if (totalCount === 0) {\n            return []\n          }\n\n          const listTop = getListTop(items)\n\n          const listBottom = listTop - scrollTop + listHeight - headerHeight - footerHeight - topListHeight\n          const maxIndex = Math.max(totalCount - 1, 0)\n          const indexOutOfAllowedRange =\n            itemLength > 0 && (items[0].index < minIndex || items[itemLength - 1].index > maxIndex)\n\n          if (listBottom < viewportHeight || indexOutOfAllowedRange) {\n            const endOffset = scrollTop + viewportHeight + overscan * 2 - 1\n            items = transposer.transpose(offsetList.range(scrollTop, endOffset, minIndex, maxIndex))\n          }\n\n          if (listTop > scrollTop) {\n            const startOffset = Math.max(scrollTop - overscan * 2, 0)\n            const endOffset = scrollTop + viewportHeight - 1\n            items = transposer.transpose(offsetList.range(startOffset, endOffset, minIndex, maxIndex))\n          }\n\n          // this is a hack - we should let the probe item render,\n          // but skip the real list until the viewport has scrolled\n          // to the expected location\n          // However, if we have default item height set then we can skip this.\n          if (items.length > 1 && !scrolledToTopMostItem && !defaultItemHeight) {\n            return []\n          }\n\n          return items\n        },\n        [] as ListItem[]\n      ),\n      duc()\n    )\n    .subscribe(list$.next)\n\n  const listOffset$ = combineLatest(list$, scrollTop$, topListHeight$).pipe(map(([items]) => getListTop(items)))\n\n  constrainedScrollTop$.subscribe(scrollTop => {\n    if (scrollTop === 0) {\n      startReached$.next(scrollTop)\n    }\n  })\n\n  let currentEndIndex = 0\n\n  list$\n    .pipe(map(items => (items.length ? items[items.length - 1].index : 0)))\n    .pipe(withLatestFrom(totalCount$))\n    .subscribe(([endIndex, totalCount]) => {\n      if (totalCount === 0) {\n        return\n      }\n\n      if (endIndex === totalCount - 1) {\n        if (currentEndIndex !== endIndex) {\n          currentEndIndex = endIndex\n          endReached$.next(endIndex)\n        }\n      }\n    })\n\n  return { list$, listOffset$, listHeight$, startReached$, endReached$ }\n}\n","import { TObservable, TSubject, subject, withLatestFrom } from '../tinyrx'\nimport { OffsetList } from '../OffsetList'\nimport { ListItem } from '../GroupIndexTransposer'\n\nexport interface MaxRangeSizeParams {\n  offsetList$: TSubject<OffsetList>\n  scrollTo$: TSubject<ScrollToOptions>\n  scrollTop$: TObservable<number>\n  list$: TObservable<ListItem[]>\n}\n\nexport function maxRangeSizeEngine({ list$, offsetList$, scrollTop$, scrollTo$ }: MaxRangeSizeParams) {\n  const scheduledReadjust$ = subject<{ index: number; offset: number } | null>(null)\n  const maxRangeSize$ = subject(Infinity)\n\n  //////////////\n  // Max range size implementation\n  // the scheduledReadjust$ can be removed through the trapNext pattern\n  //////////////\n\n  // 1. List warns us that it will reset itself.\n  offsetList$\n    .pipe(withLatestFrom(maxRangeSize$, scrollTop$, list$))\n    .subscribe(([offsetList, maxRangeSize, scrollTop, list]) =>\n      offsetList.configureMaxRangeSize(maxRangeSize, () => {\n        // 2. we pick the adjustment signal and capture the list state *before* it gets reset\n        scheduledReadjust$.next({ index: list[0].index, offset: scrollTop - list[0].offset })\n      })\n    )\n\n  // 3. once the offset list is reset, we compensate the scroll.\n  offsetList$.pipe(withLatestFrom(scheduledReadjust$)).subscribe(([offsetList, adjust]) => {\n    if (adjust !== null) {\n      const scrollTo = offsetList.offsetOf(adjust!.index) + adjust!.offset\n      scrollTo$.next({ top: scrollTo })\n      scheduledReadjust$.next(null)\n    }\n  })\n  return {\n    maxRangeSize$,\n  }\n}\n","import { AATree } from './AATree'\n\ninterface OffsetValue {\n  startIndex: number\n  endIndex: number\n  size: number\n}\n\nexport interface Item {\n  index: number\n  offset: number\n  size: number\n}\n\nexport class OffsetList {\n  public rangeTree: AATree<number>\n  public offsetTree: AATree<OffsetValue>\n  private nanIndices: number[]\n  private initialTopMostItemIndex = 0\n  private rangeSize = 0\n  private maxRangeSize = Infinity\n  private rangeSizeExceededCallback: () => void = () => {}\n\n  public static create(): OffsetList {\n    return new OffsetList(AATree.empty<number>())\n  }\n\n  private constructor(\n    rangeTree: AATree<number>,\n    offsetTree = AATree.empty<OffsetValue>(),\n    nanIndices: number[] = [],\n    initialTopMostItemIndex = 0\n  ) {\n    this.rangeTree = rangeTree\n    this.nanIndices = nanIndices\n    this.initialTopMostItemIndex = initialTopMostItemIndex\n\n    if (offsetTree.empty()) {\n      let offset = 0\n      const ranges = rangeTree.ranges()\n\n      let nanFound = false\n\n      for (const { start: startIndex, end: endIndex, value: size } of ranges) {\n        this.rangeSize++\n        if (isNaN(size)) {\n          this.nanIndices.push(startIndex)\n\n          if (!nanFound) {\n            offsetTree = offsetTree.insert(offset, {\n              startIndex,\n              endIndex: Infinity,\n              size,\n            })\n          }\n\n          nanFound = true\n        } else if (!nanFound) {\n          offsetTree = offsetTree.insert(offset, {\n            startIndex,\n            endIndex: endIndex,\n            size,\n          })\n\n          offset += (endIndex - startIndex + 1) * size\n        }\n      }\n    }\n\n    this.offsetTree = offsetTree\n  }\n\n  public empty() {\n    return this.rangeTree.empty()\n  }\n\n  private fromTree(tree: AATree<number>) {\n    return new OffsetList(tree, undefined, undefined, this.initialTopMostItemIndex)\n  }\n\n  public insert(start: number, end: number, size: number): OffsetList {\n    let tree = this.rangeTree\n    if (tree.empty()) {\n      return this.fromTree(tree.insert(0, size))\n    }\n\n    if (this.rangeSize > this.maxRangeSize) {\n      this.rangeSizeExceededCallback()\n      return this.fromTree(AATree.empty<number>().insert(0, this.getDefaultSize()))\n    }\n\n    // tree is in non-complete state - we know the group sizes, but not the item sizes\n    if (this.nanIndices.length && this.nanIndices.indexOf(end) > -1) {\n      const groupSize = tree.find(this.nanIndices[0] - 1)\n\n      if (groupSize === size) {\n        return this.fromTree(AATree.empty<number>().insert(0, size))\n      }\n      for (const nanIndex of this.nanIndices) {\n        tree = tree.insert(nanIndex, size)\n      }\n\n      return this.fromTree(tree)\n    }\n\n    // extend the range in both directions, so that we can get adjacent neighbours.\n    // if the previous / next ones have the same value as the one we are about to insert,\n    // we 'merge' them.\n    const overlapingRanges = tree.rangesWithin(start - 1, end + 1)\n\n    if (\n      overlapingRanges.some(range => {\n        return range.start === start && (range.end === end || range.end === Infinity) && range.value === size\n      })\n    ) {\n      return this\n    }\n\n    let firstPassDone = false\n    let shouldInsert = false\n    for (const { start: rangeStart, end: rangeEnd, value: rangeValue } of overlapingRanges) {\n      // previous range\n      if (!firstPassDone) {\n        shouldInsert = rangeValue !== size\n        firstPassDone = true\n      } else {\n        // remove the range if it starts within the new range OR if\n        // it has the same value as it, in order to perfrom a merge\n        if (end >= rangeStart || size === rangeValue) {\n          tree = tree.remove(rangeStart)\n        }\n      }\n\n      // next range\n      if (rangeEnd > end && end >= rangeStart) {\n        if (rangeValue !== size && !isNaN(rangeValue)) {\n          tree = tree.insert(end + 1, rangeValue)\n        }\n      }\n    }\n\n    if (shouldInsert) {\n      tree = tree.insert(start, size)\n    }\n\n    return tree === this.rangeTree ? this : this.fromTree(tree)\n  }\n\n  public insertSpots(spotIndexes: number[], value: number): OffsetList {\n    if (this.empty()) {\n      let tree = this.rangeTree\n      for (const spot of spotIndexes) {\n        tree = tree.insert(spot, value).insert(spot + 1, NaN)\n      }\n\n      return new OffsetList(tree)\n    } else {\n      throw new Error('attempting to overwrite non-empty tree')\n    }\n  }\n\n  public offsetOf(index: number): number {\n    if (this.offsetTree.empty()) {\n      return 0\n    }\n\n    const find = (value: OffsetValue) => {\n      if (value.startIndex > index) return -1\n      if (value.endIndex < index) return 1\n      return 0\n    }\n\n    const offsetRange = this.offsetTree.findWith(find)\n    if (offsetRange) {\n      const [offset, { startIndex, size }] = offsetRange\n      return offset + (index - startIndex) * size\n    } else {\n      throw new Error(`Requested offset outside of the known ones, index: ${index}`)\n    }\n  }\n\n  public itemAt(index: number): Item {\n    const size = this.rangeTree.findMaxValue(index)\n    return { index, size, offset: NaN }\n  }\n\n  public indexRange(startIndex: number, endIndex: number): Item[] {\n    if (this.rangeTree.empty()) {\n      return [{ index: this.initialTopMostItemIndex, size: 0, offset: NaN }]\n    }\n\n    const ranges = this.rangeTree.rangesWithin(startIndex, endIndex)\n    const result: Item[] = []\n\n    for (const range of ranges) {\n      const start = Math.max(startIndex, range.start)\n      const rangeEnd = typeof range.end === 'undefined' ? Infinity : range.end\n      const end = Math.min(endIndex, rangeEnd)\n\n      for (let i = start; i <= end; i++) {\n        result.push({ index: i, size: range.value, offset: NaN })\n      }\n    }\n    return result\n  }\n\n  public range(startOffset: number, endOffset: number, minIndex = 0, maxIndex = Infinity): Item[] {\n    if (this.offsetTree.empty()) {\n      return [{ index: this.initialTopMostItemIndex, size: 0, offset: 0 }]\n    }\n\n    const ranges = this.offsetTree.rangesWithin(startOffset, endOffset)\n\n    const result: Item[] = []\n\n    for (let {\n      start: rangeOffset,\n      value: { startIndex: rangeIndex, endIndex, size },\n    } of ranges) {\n      let offset = rangeOffset\n      let startIndex = rangeIndex\n\n      if (rangeOffset < startOffset) {\n        startIndex += Math.floor((startOffset - rangeOffset) / size)\n        offset += (startIndex - rangeIndex) * size\n      }\n\n      if (startIndex < minIndex) {\n        offset += (minIndex - startIndex) * size\n        startIndex = minIndex\n      }\n\n      // we don't know the size of this range - terminate with a probe item\n      if (isNaN(size)) {\n        result.push({ index: startIndex, size: 0, offset })\n        return result\n      }\n\n      endIndex = Math.min(endIndex, maxIndex)\n\n      for (let i = startIndex; i <= endIndex; i++) {\n        if (offset > endOffset) {\n          break\n        }\n\n        result.push({ index: i, size, offset })\n        offset += size\n      }\n    }\n    return result\n  }\n\n  public total(endIndex: number) {\n    const ranges = this.rangeTree.rangesWithin(0, endIndex)\n\n    let total = 0\n\n    for (let { start, end, value: size } of ranges) {\n      end = Math.min(end, endIndex)\n      total += (end - start + 1) * (isNaN(size) ? 0 : size)\n    }\n\n    return total\n  }\n\n  public getOffsets(indices: number[]): IndexList {\n    let tree = AATree.empty<number>()\n    indices.forEach(index => {\n      const offset = this.offsetOf(index)\n      tree = tree.insert(offset, index)\n    })\n    return new IndexList(tree)\n  }\n\n  public setInitialIndex(topMostItemIndex: number): OffsetList {\n    return new OffsetList(this.rangeTree, this.offsetTree, this.nanIndices, topMostItemIndex)\n  }\n\n  public getDefaultSize(): number {\n    return this.rangeTree.findMaxValue(Infinity)\n  }\n\n  public adjustForPrependedItems(count: number) {\n    return this.fromTree(this.rangeTree.shift(count))\n  }\n\n  public configureMaxRangeSize(maxRangeSize: number, maxRangeSizeExceededCallback: () => void) {\n    this.maxRangeSize = maxRangeSize\n    this.rangeSizeExceededCallback = maxRangeSizeExceededCallback\n  }\n}\n\nexport class IndexList {\n  public tree: AATree<number>\n  public constructor(tree: AATree<number>) {\n    this.tree = tree\n  }\n\n  public findMaxValue(offset: number): number {\n    return this.tree.findMaxValue(offset)\n  }\n\n  public empty(): boolean {\n    return this.tree.empty()\n  }\n}\n","import { subject, TSubject } from '../tinyrx'\nimport { ItemHeight } from '../VirtuosoStore'\n\ninterface InitialItemCountEngineParams {\n  itemHeights$: TSubject<ItemHeight[]>\n  viewportHeight$: TSubject<number>\n}\nexport function initialItemCountEngine({ itemHeights$, viewportHeight$ }: InitialItemCountEngineParams) {\n  const initialItemCount$ = subject<number>()\n  const pendingRenderAfterInitial$ = subject(false)\n\n  const unsubscribeInitial = initialItemCount$.subscribe(count => {\n    const dummyItemHeight = 30\n    itemHeights$.next([{ start: 0, end: 0, size: dummyItemHeight }])\n    viewportHeight$.next(dummyItemHeight * count)\n    pendingRenderAfterInitial$.next(true)\n    unsubscribeInitial()\n  })\n\n  return { initialItemCount$, pendingRenderAfterInitial$ }\n}\n","import { subject, map, TObservable, combineLatest, filter, withLatestFrom, TSubject } from '../tinyrx'\nimport { OffsetList } from '../OffsetList'\nimport { Transposer, ListItem } from '../GroupIndexTransposer'\n\ninterface StickyItemsEngineParams {\n  offsetList$: TObservable<OffsetList>\n  scrollTop$: TObservable<number>\n  topList$: TSubject<ListItem[]>\n  transposer$: TObservable<Transposer>\n}\nexport function stickyItemsEngine({ offsetList$, scrollTop$, topList$, transposer$ }: StickyItemsEngineParams) {\n  const stickyItems$ = subject<number[]>([])\n\n  const stickyItemsIndexList$ = combineLatest(offsetList$, stickyItems$).pipe(\n    map(([offsetList, stickyItems]) => {\n      return offsetList.getOffsets(stickyItems)\n    })\n  )\n\n  combineLatest(offsetList$, stickyItemsIndexList$, scrollTop$)\n    .pipe(\n      filter(params => !params[1].empty() && !params[0].empty()),\n      withLatestFrom(topList$, transposer$),\n      map(([[offsetList, stickyItemsIndexList, scrollTop], topList, transposer]) => {\n        const currentStickyItem = stickyItemsIndexList.findMaxValue(Math.max(scrollTop, 0))\n\n        if (topList.length === 1 && topList[0].index === currentStickyItem) {\n          return topList\n        }\n\n        const item = offsetList.itemAt(currentStickyItem)\n        return transposer.transpose([item])\n      })\n    )\n    .subscribe(topList$.next)\n\n  return {\n    stickyItems$,\n  }\n}\n","import { OffsetList } from '../OffsetList'\nimport { combineLatest, map, subject, TSubject, withLatestFrom, coldSubject } from '../tinyrx'\nimport { ItemHeight } from '../VirtuosoStore'\nimport { initialItemCountEngine } from './initialItemCountEngine'\nimport { Transposer, ListItem } from '../GroupIndexTransposer'\nimport { stickyItemsEngine } from './stickyItemsEngine'\n\ninterface OffsetListEngineParams {\n  itemHeight: number | undefined\n  defaultItemHeight: number | undefined\n  initialTopMostItemIndex: number | undefined\n  totalCount: number\n  viewportHeight$: TSubject<number>\n  scrollTop$: TSubject<number>\n  topList$: TSubject<ListItem[]>\n  transposer$: TSubject<Transposer>\n}\n\nexport function offsetListEngine({\n  totalCount,\n  itemHeight,\n  defaultItemHeight,\n  initialTopMostItemIndex,\n  viewportHeight$,\n  scrollTop$,\n  topList$,\n  transposer$,\n}: OffsetListEngineParams) {\n  const headerHeight$ = subject(0)\n  const footerHeight$ = subject(0)\n  const totalCount$ = subject(totalCount)\n  const itemHeights$ = subject<ItemHeight[]>()\n  const { pendingRenderAfterInitial$, initialItemCount$ } = initialItemCountEngine({ itemHeights$, viewportHeight$ })\n  const heightsChanged$ = coldSubject<[boolean, OffsetList]>()\n\n  let initialOffsetList = OffsetList.create()\n\n  if (itemHeight) {\n    initialOffsetList = initialOffsetList.insert(0, 0, itemHeight)\n  }\n\n  if (defaultItemHeight) {\n    initialOffsetList = initialOffsetList.insert(0, 0, defaultItemHeight)\n  }\n\n  if (initialTopMostItemIndex) {\n    initialOffsetList = initialOffsetList.setInitialIndex(initialTopMostItemIndex)\n  }\n\n  const offsetList$ = subject(initialOffsetList)\n  const { stickyItems$ } = stickyItemsEngine({ offsetList$, scrollTop$, topList$, transposer$ })\n\n  const totalHeight$ = combineLatest(offsetList$, totalCount$, headerHeight$, footerHeight$).pipe(\n    map(\n      ([offsetList, totalCount, headerHeight, footerHeight]) =>\n        offsetList.total(totalCount - 1) + headerHeight + footerHeight\n    )\n  )\n\n  if (!itemHeight) {\n    itemHeights$\n      .pipe(withLatestFrom(offsetList$, stickyItems$, pendingRenderAfterInitial$))\n      .subscribe(([heights, offsetList, stickyItems, pendingRenderAfterInitial]) => {\n        let newList = offsetList\n\n        if (pendingRenderAfterInitial) {\n          newList = OffsetList.create()\n          pendingRenderAfterInitial = false\n        }\n\n        for (const { start, end, size } of heights) {\n          if (newList.empty() && start === end && stickyItems.indexOf(start) > -1) {\n            newList = newList.insertSpots(stickyItems, size)\n          } else {\n            newList = newList.insert(start, end, size)\n          }\n        }\n\n        if (newList !== offsetList) {\n          offsetList$.next(newList)\n          heightsChanged$.next([true, newList])\n        } else {\n          heightsChanged$.next([false, newList])\n        }\n      })\n  }\n\n  return {\n    totalCount$,\n    offsetList$,\n    totalHeight$,\n    headerHeight$,\n    footerHeight$,\n    initialItemCount$,\n    itemHeights$,\n    stickyItems$,\n    heightsChanged$,\n  }\n}\n","import { TObservable, subject, combineLatest, map } from '../tinyrx'\n\ninterface ScrolledToBottomParams {\n  scrollTop$: TObservable<number>\n  viewportHeight$: TObservable<number>\n  totalHeight$: TObservable<number>\n}\n\nexport function scrolledToBottomEngine({ totalHeight$, viewportHeight$, scrollTop$ }: ScrolledToBottomParams) {\n  const scrolledToBottom$ = subject(false)\n\n  let notAtBottom: number\n\n  combineLatest(scrollTop$, viewportHeight$, totalHeight$)\n    .pipe(\n      map(([scrollTop, viewportHeight, totalHeight]) => {\n        if (viewportHeight === 0) return false\n        return totalHeight - viewportHeight - scrollTop <= 1 || totalHeight <= viewportHeight\n      })\n    )\n    .subscribe(value => {\n      clearTimeout(notAtBottom)\n      if (!value) {\n        notAtBottom = setTimeout(() => scrolledToBottom$.next(false))\n      } else {\n        scrolledToBottom$.next(true)\n      }\n    })\n\n  return {\n    scrolledToBottom$,\n  }\n}\n","import {\n  TObservable,\n  subject,\n  filter,\n  mapTo,\n  throttleTime,\n  scan,\n  map,\n  withLatestFrom,\n  duc,\n  combineLatest,\n} from '../tinyrx'\nimport { ComponentType } from 'react'\n\nexport interface ListRange {\n  startIndex: number\n  endIndex: number\n}\n\nexport interface ScrollSeekToggle {\n  (velocity: number, range: ListRange): boolean\n}\n\nexport type TSeekPlaceholder = ComponentType<{ height: number; index: number }>\n\nexport interface ScrollSeekConfiguration {\n  enter: ScrollSeekToggle\n  change: (velocity: number, range: ListRange) => void\n  exit: ScrollSeekToggle\n  placeholder: TSeekPlaceholder\n}\n\ninterface ScrollSeekParams {\n  isScrolling$: TObservable<boolean>\n  scrollTop$: TObservable<number>\n  rangeChanged$: TObservable<ListRange>\n}\n\nexport function scrollSeekEngine({ isScrolling$, scrollTop$, rangeChanged$: range$ }: ScrollSeekParams) {\n  const scrollVelocity$ = subject(0)\n  const isSeeking$ = subject(false)\n  const scrollSeekConfiguration$ = subject<ScrollSeekConfiguration | undefined | false>(false)\n\n  isScrolling$\n    .pipe(\n      filter(val => !val),\n      mapTo(0)\n    )\n    .subscribe(scrollVelocity$.next)\n\n  scrollTop$\n    .pipe(\n      throttleTime(100),\n      scan(([_, prev], next) => [prev, next], [0, 0]),\n      map(([prev, next]) => next - prev)\n    )\n    .subscribe(scrollVelocity$.next)\n\n  scrollVelocity$\n    .pipe(\n      withLatestFrom(scrollSeekConfiguration$, isSeeking$, range$),\n      filter(([_, config]) => !!config),\n      map(([speed, config, isSeeking, range]: any) => {\n        const { exit, enter } = config!\n        if (isSeeking) {\n          if (exit(speed, range)) {\n            return false\n          }\n        } else {\n          if (enter(speed, range)) {\n            return true\n          }\n        }\n        return isSeeking\n      }),\n      duc()\n    )\n    .subscribe(isSeeking$.next)\n\n  combineLatest(isSeeking$, scrollVelocity$, range$)\n    .pipe(withLatestFrom(scrollSeekConfiguration$))\n    .subscribe(([[isSeeking, velocity, range], config]) => isSeeking && config && config!.change(velocity, range))\n\n  return { isSeeking$, scrollSeekConfiguration$, scrollVelocity$ }\n}\n","import { subject, TObservable, TSubject, withLatestFrom } from '../tinyrx'\nimport { TScrollLocation } from '../EngineCommons'\nimport { OffsetList } from '../OffsetList'\n\nexport interface InitialTopMostItemIndexParams {\n  initialTopMostItemIndex: number | undefined\n  scrollTop$: TObservable<number>\n  scrollTo$: TSubject<ScrollToOptions>\n  scrollToIndex$: TSubject<TScrollLocation>\n  offsetList$: TObservable<OffsetList>\n}\n\nexport function initialTopMostItemIndexEngine({\n  initialTopMostItemIndex,\n  scrollToIndex$,\n  scrollTop$,\n  scrollTo$,\n  offsetList$,\n}: InitialTopMostItemIndexParams) {\n  const scrolledToTopMostItem$ = subject(!initialTopMostItemIndex)\n\n  scrollTop$\n    .pipe(withLatestFrom(scrollTo$, scrolledToTopMostItem$))\n    .subscribe(([scrollTop, scrollTo, scrolledToTopMostItem]) => {\n      if (scrollTop === scrollTo.top && !scrolledToTopMostItem) {\n        // skip a tick, so that the list$ can grab the scrollTop$ update\n        setTimeout(() => {\n          scrolledToTopMostItem$.next(true)\n        })\n      }\n    })\n\n  offsetList$.pipe(withLatestFrom(scrolledToTopMostItem$)).subscribe(([_, scrolledToTopMostItem]) => {\n    if (!scrolledToTopMostItem) {\n      // hack: wait for the viewport to get populated :(\n      setTimeout(() => {\n        scrollToIndex$.next(initialTopMostItemIndex!)\n      })\n    }\n  })\n\n  return {\n    scrolledToTopMostItem$,\n  }\n}\n","import { TScrollLocation } from '../EngineCommons'\nimport { OffsetList } from '../OffsetList'\nimport { coldSubject, map, subject, TObservable, TSubject, withLatestFrom, filter } from '../tinyrx'\nimport { initialTopMostItemIndexEngine } from './initialTopMostItemEngine'\n\nexport interface ScrollToIndexParams {\n  heightsChanged$: TSubject<[boolean, OffsetList]>\n  offsetList$: TSubject<OffsetList>\n  topListHeight$: TObservable<number>\n  stickyItems$: TObservable<number[]>\n  viewportHeight$: TSubject<number>\n  totalCount$: TObservable<number>\n  totalHeight$: TObservable<number>\n  scrollTop$: TObservable<number>\n  initialTopMostItemIndex: number | undefined\n}\n\nexport function scrollToIndexEngine({\n  offsetList$,\n  topListHeight$,\n  stickyItems$,\n  viewportHeight$,\n  totalCount$,\n  totalHeight$,\n  initialTopMostItemIndex,\n  heightsChanged$,\n  scrollTop$,\n}: ScrollToIndexParams) {\n  const scrollToIndex$ = coldSubject<TScrollLocation>()\n  const scrollToIndexRequestPending$ = subject(false)\n  const scrollTopReportedAfterScrollToIndex$ = subject(true)\n  const scrollTo$ = coldSubject<ScrollToOptions>()\n\n  const { scrolledToTopMostItem$ } = initialTopMostItemIndexEngine({\n    scrollTo$,\n    offsetList$,\n    scrollToIndex$,\n    scrollTop$,\n    initialTopMostItemIndex,\n  })\n\n  heightsChanged$.pipe(withLatestFrom(scrolledToTopMostItem$)).subscribe(([[changed], scrolledToTopMostItem]) => {\n    if (!changed && scrolledToTopMostItem) {\n      scrollToIndexRequestPending$.next(false)\n      scrollTopReportedAfterScrollToIndex$.next(true)\n    }\n  })\n\n  scrollToIndex$\n    .pipe(\n      withLatestFrom(offsetList$, topListHeight$, stickyItems$, viewportHeight$, totalCount$, totalHeight$),\n      map(([location, offsetList, topListHeight, stickyItems, viewportHeight, totalCount, totalHeight]) => {\n        if (offsetList.empty()) {\n          setTimeout(() => scrollToIndex$.next(location))\n          return\n        }\n\n        if (typeof location === 'number') {\n          location = { index: location, align: 'start', behavior: 'auto' }\n        }\n        let { index, align = 'start' } = location\n\n        index = Math.max(0, index, Math.min(totalCount - 1, index))\n\n        let offset = offsetList.offsetOf(index)\n        if (align === 'end') {\n          offset = offset - viewportHeight + offsetList.itemAt(index).size\n        } else if (align === 'center') {\n          offset = Math.round(offset - viewportHeight / 2 + offsetList.itemAt(index).size / 2)\n        } else {\n          if (stickyItems.indexOf(index) === -1) {\n            offset -= topListHeight\n          }\n        }\n\n        scrollTopReportedAfterScrollToIndex$.next(false)\n        return {\n          top: Math.max(0, Math.min(offset, Math.floor(totalHeight - viewportHeight))),\n          behavior: location.behavior ?? 'auto',\n        }\n      }),\n      filter(value => value !== undefined)\n    )\n    .subscribe(scrollTo$.next as any)\n\n  scrollTop$.pipe(withLatestFrom(scrollTopReportedAfterScrollToIndex$)).subscribe(([_, scrollTopReported]) => {\n    if (!scrollTopReported) {\n      scrollTopReportedAfterScrollToIndex$.next(true)\n      scrollToIndexRequestPending$.next(true)\n    }\n  })\n\n  // if the list has received new heights, the scrollTo call calculations were wrong;\n  // we will retry by re-requesting the same index\n  offsetList$\n    .pipe(withLatestFrom(scrollToIndexRequestPending$, scrollToIndex$))\n    .subscribe(([_, scrollToIndexRequestPending, scrollToIndex]) => {\n      if (scrollToIndexRequestPending) {\n        scrollToIndex$.next(scrollToIndex)\n      }\n    })\n\n  return {\n    scrollToIndex$,\n    scrollTo$,\n    scrolledToTopMostItem$,\n  }\n}\n","import { TObservable, subject, combineLatest, filter, withLatestFrom, map, TSubject } from '../tinyrx'\nimport { OffsetList } from '../OffsetList'\nimport { Transposer, ListItem } from '../GroupIndexTransposer'\n\ninterface TopItemCountParams {\n  offsetList$: TObservable<OffsetList>\n  totalCount$: TObservable<number>\n  topList$: TSubject<ListItem[]>\n  viewportHeight$: TObservable<number>\n  transposer$: TObservable<Transposer>\n}\nexport function topItemCountEngine({\n  topList$,\n  transposer$,\n  viewportHeight$,\n  totalCount$,\n  offsetList$,\n}: TopItemCountParams) {\n  const topItemCount$ = subject<number>()\n\n  combineLatest(offsetList$, topItemCount$, totalCount$, viewportHeight$)\n    .pipe(\n      filter(params => params[1] > 0 && params[3] > 0),\n      withLatestFrom(transposer$),\n      map(([[offsetList, topItemCount, totalCount], transposer]) => {\n        const endIndex = Math.max(0, Math.min(topItemCount - 1, totalCount))\n        return transposer.transpose(offsetList.indexRange(0, endIndex))\n      })\n    )\n    .subscribe(topList$.next)\n  return { topItemCount$ }\n}\n","import { subject, map } from '../tinyrx'\nimport { ListItem } from '../GroupIndexTransposer'\n\nexport function topListEngine() {\n  const topList$ = subject<ListItem[]>([])\n\n  const topListHeight$ = topList$.pipe(map(items => items.reduce((total, item) => total + item.size, 0)))\n\n  const minListIndex$ = topList$.pipe(\n    map(topList => {\n      return topList.length && topList[topList.length - 1].index + 1\n    })\n  )\n\n  return {\n    topList$,\n    topListHeight$,\n    minListIndex$,\n  }\n}\n","import { TObservable, TSubscription } from './tinyrx'\n\nexport interface TOutput<T> {\n  (callback: TCallback<T> | undefined): void\n}\n\nexport interface TInput<T> {\n  (val: T): void\n}\n\ntype TCallback<T> = (val: T) => void\n\nexport function makeOutput<T>(observable: TObservable<T>): TOutput<T> {\n  let unsubscribe: TSubscription | undefined\n\n  return (callback: TCallback<T> | undefined) => {\n    if (unsubscribe) {\n      unsubscribe()\n    }\n    if (callback) {\n      unsubscribe = observable.subscribe(callback)\n    }\n  }\n}\n\nexport function makeInput<T>(subject: { next: (value: T) => void }): TInput<T> {\n  return subject.next\n}\n","import * as React from 'react'\nimport { ReactElement } from 'react'\nimport { coldSubject, combineLatest, duc, filter, map, subject, withLatestFrom } from '../src/tinyrx'\nimport { buildIsScrolling } from './EngineCommons'\nimport { adjustForPrependedItemsEngine } from './engines/adjustForPrependedItemsEngine'\nimport { followOutputEngine } from './engines/followOutputEngine'\nimport { groupCountEngine } from './engines/groupCountEgine'\nimport { listEngine } from './engines/listEngine'\nimport { maxRangeSizeEngine } from './engines/maxRangeSizeEngine'\nimport { offsetListEngine } from './engines/offsetListEngine'\nimport { scrolledToBottomEngine } from './engines/scrolledToBottomEngine'\nimport { ListRange, scrollSeekEngine } from './engines/scrollSeekEngine'\nimport { scrollToIndexEngine } from './engines/scrollToIndexEngine'\nimport { topItemCountEngine } from './engines/topItemCountEngine'\nimport { topListEngine } from './engines/topListEngine'\nimport { ListItem, StubIndexTransposer, Transposer } from './GroupIndexTransposer'\nimport { makeInput, makeOutput } from './rxio'\n\nexport interface ItemHeight {\n  start: number\n  end: number\n  size: number\n}\n\ninterface TVirtuosoConstructorParams {\n  overscan?: number\n  totalCount?: number\n  topItems?: number\n  itemHeight?: number\n  defaultItemHeight?: number\n  initialTopMostItemIndex?: number\n}\n\nconst VirtuosoStore = ({\n  overscan = 0,\n  totalCount = 0,\n  itemHeight,\n  initialTopMostItemIndex,\n  defaultItemHeight,\n}: TVirtuosoConstructorParams) => {\n  const transposer$ = subject<Transposer>(new StubIndexTransposer())\n  const viewportHeight$ = subject(0)\n  const scrollTop$ = subject(0, false)\n  const isScrolling$ = buildIsScrolling(scrollTop$)\n\n  const { topList$, minListIndex$, topListHeight$ } = topListEngine()\n  const {\n    stickyItems$,\n    initialItemCount$,\n    itemHeights$,\n    offsetList$,\n    totalCount$,\n    headerHeight$,\n    footerHeight$,\n    totalHeight$,\n    heightsChanged$,\n  } = offsetListEngine({\n    totalCount,\n    itemHeight,\n    defaultItemHeight,\n    initialTopMostItemIndex,\n    viewportHeight$,\n    scrollTop$,\n    transposer$,\n    topList$,\n  })\n\n  const { groupCounts$, groupIndices$ } = groupCountEngine({ totalCount$, transposer$, stickyItems$ })\n\n  const { scrolledToBottom$ } = scrolledToBottomEngine({ totalHeight$, viewportHeight$, scrollTop$ })\n\n  const { scrolledToTopMostItem$, scrollToIndex$, scrollTo$ } = scrollToIndexEngine({\n    initialTopMostItemIndex,\n    scrollTop$,\n    offsetList$,\n    viewportHeight$,\n    totalHeight$,\n    stickyItems$,\n    totalCount$,\n    topListHeight$,\n    heightsChanged$,\n  })\n\n  const { listHeight$, list$, listOffset$, startReached$, endReached$ } = listEngine({\n    overscan,\n    defaultItemHeight,\n    viewportHeight$,\n    scrollTop$,\n    totalHeight$,\n    topListHeight$,\n    headerHeight$,\n    footerHeight$,\n    minListIndex$,\n    totalCount$,\n    offsetList$,\n    scrolledToTopMostItem$,\n    transposer$,\n  })\n\n  const { adjustForPrependedItems$, adjustmentInProgress$ } = adjustForPrependedItemsEngine({\n    offsetList$,\n    scrollTop$,\n    scrollTo$,\n  })\n\n  const { maxRangeSize$ } = maxRangeSizeEngine({ scrollTo$, offsetList$, scrollTop$, list$ })\n\n  const { topItemCount$ } = topItemCountEngine({ offsetList$, totalCount$, transposer$, viewportHeight$, topList$ })\n\n  const { followOutput$ } = followOutputEngine({ totalCount$, scrollToIndex$, scrolledToBottom$ })\n\n  const stickyItemsOffset$ = listOffset$.pipe(map(offset => -offset))\n\n  const rangeChanged$ = coldSubject<ListRange>()\n\n  list$\n    .pipe(\n      withLatestFrom(adjustmentInProgress$),\n      filter<[ListItem[], boolean]>(([list, inProgress]) => list.length !== 0 && !inProgress),\n      map(([list]) => {\n        const { index: startIndex } = list[0]\n        const { index: endIndex } = list[list.length - 1]\n        return { startIndex, endIndex }\n      }),\n      duc((current, next) => !current || current.startIndex !== next.startIndex || current.endIndex !== next.endIndex)\n    )\n    .subscribe(rangeChanged$.next)\n\n  const { isSeeking$, scrollVelocity$, scrollSeekConfiguration$ } = scrollSeekEngine({\n    scrollTop$,\n    isScrolling$,\n    rangeChanged$,\n  })\n\n  const MAX_OFFSET_HEIGHT = 15000000\n  const domTotalHeight$ = totalHeight$.pipe(map(value => Math.min(value, MAX_OFFSET_HEIGHT)))\n\n  const scrollTopMultiplier$ = combineLatest(totalHeight$, domTotalHeight$, viewportHeight$).pipe(\n    map(([totalHeight, domTotalHeight, viewportHeight]) => {\n      if (totalHeight === domTotalHeight || domTotalHeight === viewportHeight) {\n        return 1\n      }\n      return (totalHeight - viewportHeight) / (domTotalHeight - viewportHeight)\n    })\n  )\n\n  const domScrollTop$ = subject(0, false)\n\n  const domListOffset$ = combineLatest(listOffset$, scrollTopMultiplier$).pipe(\n    map(([offset, multiplier]) => offset / multiplier)\n  )\n\n  combineLatest(domScrollTop$, scrollTopMultiplier$)\n    .pipe(map(([domScrollTop, multiplier]) => domScrollTop * multiplier))\n    .subscribe(scrollTop$.next)\n\n  const computeItemKey$ = subject((itemIndex: number) => itemIndex as React.Key)\n  const renderProp$ = subject((index: number, _groupIndex?: number) => index as any)\n  const groupRenderProp$ = subject((index: number) => index as any)\n  const itemContainer$ = subject<React.ComponentType<any> | string>('div')\n  const groupContainer$ = subject<React.ComponentType<any> | string>('div')\n  const itemRender$ = subject<any>(false)\n  const dataKey$ = subject<string | symbol | undefined>(Symbol('data-key'))\n\n  combineLatest(\n    renderProp$,\n    groupRenderProp$,\n    scrollSeekConfiguration$,\n    computeItemKey$,\n    itemContainer$,\n    groupContainer$,\n    dataKey$\n  )\n    .pipe(\n      map(([render, groupRender, scrollSeek, computeItemKey, ItemContainer, GroupContainer, _dataKey]) => {\n        return {\n          render: (item: any, { key, renderPlaceholder, ...itemProps }: any) => {\n            if (computeItemKey) {\n              key = computeItemKey(item.index)\n            }\n\n            if (item.type === 'group') {\n              return React.createElement(GroupContainer, { key, ...itemProps }, groupRender(item.groupIndex))\n            } else {\n              let children: ReactElement\n              if (scrollSeek && renderPlaceholder) {\n                children = React.createElement(scrollSeek.placeholder, {\n                  height: itemProps['data-known-size'],\n                  index: item.index,\n                })\n              } else {\n                children = render(item.transposedIndex, item.groupIndex)\n              }\n\n              return React.createElement(ItemContainer, { ...itemProps, key }, children)\n            }\n          },\n        }\n      })\n    )\n    .subscribe(itemRender$.next)\n\n  return {\n    groupCounts: makeInput(groupCounts$),\n    itemHeights: makeInput(itemHeights$),\n    headerHeight: makeInput(headerHeight$),\n    footerHeight: makeInput(footerHeight$),\n    listHeight: makeInput(listHeight$),\n    viewportHeight: makeInput(viewportHeight$),\n    scrollTop: makeInput(domScrollTop$),\n    topItemCount: makeInput(topItemCount$),\n    totalCount: makeInput(totalCount$),\n    scrollToIndex: makeInput(scrollToIndex$),\n    initialItemCount: makeInput(initialItemCount$),\n    followOutput: makeInput(followOutput$),\n    adjustForPrependedItems: makeInput(adjustForPrependedItems$),\n    maxRangeSize: makeInput(maxRangeSize$),\n    scrollSeekConfiguration: makeInput(scrollSeekConfiguration$),\n\n    renderProp: makeInput(renderProp$),\n    groupRenderProp: makeInput(groupRenderProp$),\n    computeItemKey: makeInput(computeItemKey$),\n    itemContainer: makeInput(itemContainer$),\n    groupContainer: makeInput(groupContainer$),\n    dataKey: makeInput(dataKey$),\n\n    itemRender: makeOutput(itemRender$),\n\n    list: makeOutput(list$),\n    isSeeking: makeOutput(isSeeking$),\n    scrollVelocity: makeOutput(scrollVelocity$),\n    itemsRendered: makeOutput(list$),\n    topList: makeOutput(topList$),\n    listOffset: makeOutput(domListOffset$),\n    totalHeight: makeOutput(domTotalHeight$),\n    startReached: makeOutput(startReached$),\n    endReached: makeOutput(endReached$),\n    atBottomStateChange: makeOutput(scrolledToBottom$),\n    totalListHeightChanged: makeOutput(totalHeight$),\n    rangeChanged: makeOutput(rangeChanged$),\n    isScrolling: makeOutput(isScrolling$),\n    stickyItems: makeOutput(stickyItems$),\n    groupIndices: makeOutput(groupIndices$),\n    stickyItemsOffset: makeOutput(stickyItemsOffset$),\n    scrollTo: makeOutput(scrollTo$),\n  }\n}\n\nexport { VirtuosoStore }\n","import { CSSProperties } from 'react'\n\nexport const viewportStyle: CSSProperties = {\n  top: 0,\n  position: 'absolute',\n  height: '100%',\n  width: '100%',\n}\n","import { useEffect, useRef, useState } from 'react'\nimport ResizeObserver from 'resize-observer-polyfill'\nimport { TInput, TOutput } from './rxio'\n\nexport type CallbackRefParam = HTMLElement | null\nexport type CallbackRef = (ref: CallbackRefParam) => void\n\ntype UseHeight = (\n  input: TInput<number>,\n  onMount?: (ref: CallbackRefParam) => void,\n  onResize?: (ref: HTMLElement) => void\n) => CallbackRef\n\nexport const useHeight: UseHeight = (input, onMount, onResize) => {\n  const ref = useRef<CallbackRefParam>(null)\n  const animationFrameID = useRef<number>(0)\n  const observer = new ResizeObserver(entries => {\n    const newHeight = Math.round(entries[0].contentRect.height)\n    if (onResize) {\n      animationFrameID.current = window.requestAnimationFrame(() => {\n        const element = entries[0].target as HTMLElement\n        if (document.body.contains(element)) {\n          onResize(element)\n        }\n      })\n    }\n    input(newHeight)\n  })\n\n  const callbackRef = (elRef: CallbackRefParam) => {\n    if (elRef) {\n      observer.observe(elRef)\n      if (onMount) {\n        onMount(elRef)\n      }\n      ref.current = elRef\n    } else {\n      observer.unobserve(ref.current!)\n      ref.current = null\n    }\n  }\n\n  useEffect(() => () => window.cancelAnimationFrame(animationFrameID.current), [])\n  return callbackRef\n}\n\nfunction callbackToValue<T>(output: (callback: (val: T) => void) => void, defaultValue: T) {\n  return () => {\n    let result = defaultValue\n    output(val => {\n      result = val\n    })\n    return result\n  }\n}\n\nexport function useOutput<T>(output: TOutput<T>, initialValue: T): T {\n  const [value, setValue] = useState(callbackToValue<T>(output, initialValue))\n\n  useEffect(() => {\n    output(setValue)\n    return () => output(undefined)\n  }, [output])\n  return value\n}\n\ntype UseSize = (callback: (params: { element: HTMLElement; width: number; height: number }) => void) => CallbackRef\n\nexport const useSize: UseSize = callback => {\n  const ref = useRef<CallbackRefParam>(null)\n  const currentSize = useRef([0, 0])\n\n  const observer = new ResizeObserver(entries => {\n    const { width, height } = entries[0].contentRect\n    if (currentSize.current[0] !== width || currentSize.current[1] !== height) {\n      currentSize.current = [width, height]\n      callback({\n        element: entries[0].target as HTMLElement,\n        width: Math.round(width),\n        height: Math.round(height),\n      })\n    }\n  })\n\n  const callbackRef = (elRef: CallbackRefParam) => {\n    if (elRef) {\n      observer.observe(elRef)\n      ref.current = elRef\n    } else {\n      observer.unobserve(ref.current!)\n      ref.current = null\n    }\n  }\n\n  return callbackRef\n}\n\nexport function simpleMemoize<T extends () => any>(func: T): T {\n  let called = false\n  let result: any\n\n  return (() => {\n    if (!called) {\n      called = true\n      result = func()\n    }\n    return result\n  }) as T\n}\n\nconst WEBKIT_STICKY = '-webkit-sticky'\nconst STICKY = 'sticky'\n\nexport const positionStickyCssValue = simpleMemoize(() => {\n  const node = document.createElement('div')\n  node.style.position = WEBKIT_STICKY\n  return node.style.position === WEBKIT_STICKY ? WEBKIT_STICKY : STICKY\n})\n","import * as React from 'react'\nimport { FC } from 'react'\n\nexport const VirtuosoFiller: FC<{ height: number }> = ({ height }) => (\n  <div style={{ height: `${height}px`, position: 'absolute', top: 0 }}>&nbsp;</div>\n)\n","import * as React from 'react'\nimport { useContext, ReactElement, CSSProperties, ReactNode, createElement, ComponentType } from 'react'\nimport { useOutput, positionStickyCssValue } from './Utils'\nimport { VirtuosoContext } from './VirtuosoContext'\nimport { ListItem } from './GroupIndexTransposer'\n\nexport interface TRenderProps {\n  key: React.Key\n  'data-index': number\n  'data-known-size': number\n  renderPlaceholder: boolean\n  style?: CSSProperties\n}\nexport type TRender = (item: ListItem, props: TRenderProps) => ReactElement\n\nexport interface VirtuosoListProps {\n  emptyComponent?: ComponentType\n}\n\nexport const VirtuosoList: React.FC<VirtuosoListProps> = React.memo(({ emptyComponent }) => {\n  const { isSeeking, topList, list, itemRender } = useContext(VirtuosoContext)!\n  const items = useOutput<ListItem[]>(list, [])\n  const topItems = useOutput<ListItem[]>(topList, [])\n  const render = useOutput(itemRender, false as any)\n  const renderPlaceholder = useOutput(isSeeking, false)\n\n  const renderedItems: ReactNode[] = []\n  let topOffset = 0\n  const renderedTopItemIndices: number[] = []\n\n  const marginTop = topItems.reduce((acc, item) => {\n    return acc + item.size\n  }, 0)\n\n  topItems.forEach((item, index) => {\n    const itemIndex = item.index\n    renderedTopItemIndices.push(itemIndex)\n\n    const style: CSSProperties = {\n      top: `${topOffset}px`,\n      marginTop: index === 0 ? `${-marginTop}px` : undefined,\n      zIndex: 2,\n      position: positionStickyCssValue(),\n    }\n\n    const props = {\n      key: itemIndex,\n      'data-index': itemIndex,\n      'data-known-size': item.size,\n      renderPlaceholder,\n      style,\n    }\n\n    render && renderedItems.push(render.render(item, props))\n    topOffset += item.size\n  })\n\n  items.forEach(item => {\n    if (renderedTopItemIndices.indexOf(item.index) > -1) {\n      return\n    }\n\n    render &&\n      renderedItems.push(\n        render.render(item, {\n          key: item.index,\n          'data-index': item.index,\n          'data-known-size': item.size,\n          renderPlaceholder,\n        })\n      )\n  })\n\n  if (renderedItems.length === 0 && emptyComponent) return createElement(emptyComponent)\n  return <>{renderedItems}</>\n})\n","import * as React from 'react'\nimport { FC, CSSProperties, useCallback, useRef } from 'react'\n\nconst scrollerStyle: React.CSSProperties = {\n  height: '100%',\n  overflowY: 'auto',\n  WebkitOverflowScrolling: 'touch',\n  position: 'relative',\n  outline: 'none',\n}\n\nexport type TScrollContainer = FC<{\n  style: CSSProperties\n  className?: string\n  reportScrollTop: (scrollTop: number) => void\n  scrollTo: (callback: (scrollTop: ScrollToOptions) => void) => void\n}>\n\nconst DefaultScrollContainer: TScrollContainer = ({ className, style, reportScrollTop, scrollTo, children }) => {\n  const elRef = useRef<HTMLElement | null>(null)\n  const smoothScrollTarget = useRef<number | null>(null)\n  const currentScrollTop = useRef<number | null>()\n\n  const onScroll: EventListener = useCallback(\n    (e: Event) => {\n      const scrollTop = (e.target as HTMLDivElement).scrollTop\n      currentScrollTop.current = scrollTop\n      if (smoothScrollTarget.current !== null) {\n        if (smoothScrollTarget.current === scrollTop) {\n          // console.log('reporting smooth scrolling')\n          smoothScrollTarget.current = null\n          reportScrollTop(scrollTop)\n        } else {\n          // console.log('skip reporting')\n        }\n      } else {\n        reportScrollTop(scrollTop)\n      }\n    },\n    [reportScrollTop]\n  )\n\n  const ref = useCallback(\n    (theRef: HTMLElement | null) => {\n      if (theRef) {\n        theRef.addEventListener('scroll', onScroll, { passive: true })\n        elRef.current = theRef\n      } else {\n        if (elRef.current) {\n          elRef.current.removeEventListener('scroll', onScroll)\n        }\n      }\n    },\n    [onScroll]\n  )\n\n  scrollTo(location => {\n    if (currentScrollTop.current !== location.top) {\n      if (location.behavior === 'smooth') {\n        smoothScrollTarget.current = location.top!\n      }\n      elRef.current && elRef.current!.scrollTo(location)\n    }\n  })\n\n  return (\n    <div ref={ref} style={style} tabIndex={0} className={className}>\n      {children}\n    </div>\n  )\n}\n\nexport const VirtuosoScroller: FC<{\n  className?: string\n  style: CSSProperties\n  ScrollContainer?: TScrollContainer\n  scrollTop: (scrollTop: number) => void\n  scrollTo: (callback: (scrollTop: ScrollToOptions) => void) => void\n}> = ({ children, style, className, ScrollContainer = DefaultScrollContainer, scrollTop, scrollTo }) => {\n  return (\n    <ScrollContainer\n      style={{ ...scrollerStyle, ...style }}\n      reportScrollTop={scrollTop}\n      scrollTo={scrollTo}\n      className={className}\n    >\n      {children}\n    </ScrollContainer>\n  )\n}\n","import * as React from 'react'\nimport { CSSProperties, FC, ReactElement, useContext, ComponentType } from 'react'\nimport { ItemHeight } from 'VirtuosoStore'\nimport { viewportStyle } from './Style'\nimport { CallbackRef, useHeight, useOutput } from './Utils'\nimport { VirtuosoContext } from './VirtuosoContext'\nimport { VirtuosoFiller } from './VirtuosoFiller'\nimport { VirtuosoList } from './VirtuosoList'\nimport { TScrollContainer, VirtuosoScroller } from './VirtuosoScroller'\n\nexport const DefaultHeaderContainer: React.FC<{ headerRef: CallbackRef }> = ({ children, headerRef }) => (\n  <header ref={headerRef}>{children}</header>\n)\n\nexport const DefaultFooterContainer: React.FC<{ footerRef: CallbackRef }> = ({ children, footerRef }) => (\n  <footer ref={footerRef}>{children}</footer>\n)\n\nexport const DefaultListContainer: React.FC<{ listRef: CallbackRef; style: CSSProperties }> = ({\n  children,\n  listRef,\n  style,\n}) => {\n  return (\n    <div ref={listRef} style={style}>\n      {children}\n    </div>\n  )\n}\n\nexport type TListContainer = typeof DefaultListContainer\nexport type THeaderContainer = typeof DefaultHeaderContainer\nexport type TFooterContainer = typeof DefaultFooterContainer\n\nexport { TScrollContainer }\n\nconst VirtuosoHeader: FC<{ header: () => ReactElement; HeaderContainer?: THeaderContainer }> = ({\n  header,\n  HeaderContainer = DefaultHeaderContainer,\n}) => {\n  const headerCallbackRef = useHeight(useContext(VirtuosoContext)!.headerHeight)\n  return <HeaderContainer headerRef={headerCallbackRef}>{header()}</HeaderContainer>\n}\n\nconst VirtuosoFooter: FC<{ footer: () => ReactElement; FooterContainer?: TFooterContainer }> = ({\n  footer,\n  FooterContainer = DefaultFooterContainer,\n}) => {\n  const footerCallbackRef = useHeight(useContext(VirtuosoContext)!.footerHeight)\n  return <FooterContainer footerRef={footerCallbackRef}>{footer()}</FooterContainer>\n}\n\nconst getHeights = (children: HTMLCollection) => {\n  const results: ItemHeight[] = []\n  for (let i = 0, len = children.length; i < len; i++) {\n    const child = children.item(i) as HTMLElement\n\n    if (!child || child.dataset.index === undefined) {\n      continue\n    }\n\n    const index = parseInt(child.dataset.index!)\n    const knownSize = parseInt(child.dataset.knownSize!)\n    const size = child.offsetHeight\n\n    if (size === knownSize || size === 0) {\n      continue\n    }\n\n    const lastResult = results[results.length - 1]\n    if (results.length === 0 || lastResult.size !== size || lastResult.end !== index - 1) {\n      results.push({ start: index, end: index, size })\n    } else {\n      results[results.length - 1].end++\n    }\n  }\n\n  return results\n}\n\nconst ListWrapper: React.FC<{ fixedItemHeight: boolean; ListContainer: TListContainer }> = ({\n  fixedItemHeight,\n  children,\n  ListContainer,\n}) => {\n  const { listHeight, itemHeights, listOffset } = useContext(VirtuosoContext)!\n  const translate = useOutput<number>(listOffset, 0)\n  const style = { marginTop: `${translate}px` }\n\n  const listCallbackRef = useHeight(\n    listHeight,\n    () => {},\n    ref => {\n      if (!fixedItemHeight) {\n        const measuredItemHeights = getHeights(ref!.children)\n        itemHeights(measuredItemHeights)\n      }\n    }\n  )\n\n  return (\n    <ListContainer listRef={listCallbackRef} style={style}>\n      {children}\n    </ListContainer>\n  )\n}\n\nexport const VirtuosoView: React.FC<{\n  style: CSSProperties\n  className?: string\n  header?: () => ReactElement\n  footer?: () => ReactElement\n  ScrollContainer?: TScrollContainer\n  ListContainer: TListContainer\n  HeaderContainer?: THeaderContainer\n  FooterContainer?: TFooterContainer\n  fixedItemHeight: boolean\n  emptyComponent?: ComponentType\n}> = ({\n  style,\n  header,\n  footer,\n  fixedItemHeight,\n  ScrollContainer,\n  ListContainer,\n  HeaderContainer,\n  FooterContainer,\n  className,\n  emptyComponent,\n}) => {\n  const { scrollTo, scrollTop, totalHeight, viewportHeight } = useContext(VirtuosoContext)!\n  const fillerHeight = useOutput<number>(totalHeight, 0)\n  const reportScrollTop = (st: number) => {\n    scrollTop(Math.max(st, 0))\n  }\n\n  const viewportCallbackRef = useHeight(viewportHeight)\n\n  return (\n    <VirtuosoScroller\n      style={style}\n      ScrollContainer={ScrollContainer}\n      className={className}\n      scrollTo={scrollTo}\n      scrollTop={reportScrollTop}\n    >\n      <div ref={viewportCallbackRef} style={viewportStyle}>\n        <ListWrapper fixedItemHeight={fixedItemHeight} ListContainer={ListContainer}>\n          {header && <VirtuosoHeader header={header} HeaderContainer={HeaderContainer} />}\n          <VirtuosoList emptyComponent={emptyComponent} />\n          {footer && <VirtuosoFooter footer={footer} FooterContainer={FooterContainer} />}\n        </ListWrapper>\n      </div>\n\n      <VirtuosoFiller height={fillerHeight} />\n    </VirtuosoScroller>\n  )\n}\n","import * as React from 'react'\nimport {\n  CSSProperties,\n  FC,\n  forwardRef,\n  ReactElement,\n  useImperativeHandle,\n  useEffect,\n  useState,\n  ComponentType,\n} from 'react'\nimport { TScrollLocation } from './EngineCommons'\nimport { ListRange, ScrollSeekConfiguration } from './engines/scrollSeekEngine'\nimport { ListItem } from './GroupIndexTransposer'\nimport { TSubscriber } from './tinyrx'\nimport { VirtuosoContext } from './VirtuosoContext'\nimport { TRenderProps } from './VirtuosoList'\nimport { VirtuosoStore } from './VirtuosoStore'\nimport {\n  DefaultListContainer,\n  THeaderContainer,\n  TFooterContainer,\n  TListContainer,\n  TScrollContainer,\n  VirtuosoView,\n} from './VirtuosoView'\n\nexport type VirtuosoState = ReturnType<typeof VirtuosoStore>\n\nexport type TItemContainer = React.FC<Omit<TRenderProps, 'renderPlaceholder' | 'scrollVelocity'>>\n\nexport interface VirtuosoProps {\n  totalCount: number\n  overscan?: number\n  topItems?: number\n  header?: () => ReactElement\n  footer?: () => ReactElement\n  item: (index: number) => ReactElement\n  computeItemKey?: (index: number) => React.Key\n  prependItemCount?: number\n  itemHeight?: number\n  defaultItemHeight?: number\n  startReached?: () => void\n  endReached?: (index: number) => void\n  scrollingStateChange?: TSubscriber<boolean>\n  atBottomStateChange?: TSubscriber<boolean>\n  itemsRendered?: TSubscriber<ListItem[]>\n  rangeChanged?: TSubscriber<ListRange>\n  totalListHeightChanged?: TSubscriber<number>\n  style?: CSSProperties\n  dataKey?: string\n  className?: string\n  initialItemCount?: number\n  initialTopMostItemIndex?: number\n  followOutput?: boolean\n  ScrollContainer?: TScrollContainer\n  HeaderContainer?: THeaderContainer\n  FooterContainer?: TFooterContainer\n  ListContainer?: TListContainer\n  ItemContainer?: TItemContainer\n  maxHeightCacheSize?: number\n  scrollSeek?: ScrollSeekConfiguration\n  emptyComponent?: ComponentType\n}\n\nexport interface TVirtuosoPresentationProps {\n  contextValue: VirtuosoState\n  header?: () => ReactElement\n  footer?: () => ReactElement\n  style?: CSSProperties\n  className?: string\n  itemHeight?: number\n  ScrollContainer?: TScrollContainer\n  HeaderContainer?: THeaderContainer\n  FooterContainer?: TFooterContainer\n  ListContainer?: TListContainer\n  emptyComponent?: ComponentType\n}\n\nexport { TScrollContainer, TListContainer }\n\nconst DEFAULT_STYLE = {}\nexport const VirtuosoPresentation: FC<TVirtuosoPresentationProps> = React.memo(\n  ({\n    contextValue,\n    style,\n    className,\n    header,\n    footer,\n    itemHeight,\n    ScrollContainer,\n    ListContainer,\n    HeaderContainer,\n    FooterContainer,\n    emptyComponent,\n  }) => {\n    return (\n      <VirtuosoContext.Provider value={contextValue}>\n        <VirtuosoView\n          style={style || DEFAULT_STYLE}\n          className={className}\n          header={header}\n          footer={footer}\n          fixedItemHeight={itemHeight !== undefined}\n          ScrollContainer={ScrollContainer}\n          HeaderContainer={HeaderContainer}\n          FooterContainer={FooterContainer}\n          ListContainer={ListContainer || DefaultListContainer}\n          emptyComponent={emptyComponent}\n        />\n      </VirtuosoContext.Provider>\n    )\n  }\n)\n\nexport interface VirtuosoMethods {\n  scrollToIndex(location: TScrollLocation): void\n  adjustForPrependedItems(count: number): void\n}\n\nexport const Virtuoso = forwardRef<VirtuosoMethods, VirtuosoProps>((props, ref) => {\n  const [state] = useState(() => VirtuosoStore(props))\n  useImperativeHandle(\n    ref,\n    () => ({\n      scrollToIndex: (location: TScrollLocation) => {\n        state.scrollToIndex(location)\n      },\n\n      adjustForPrependedItems: (count: number) => {\n        state.adjustForPrependedItems(count)\n      },\n    }),\n    [state]\n  )\n\n  useEffect(() => {\n    state.isScrolling(props.scrollingStateChange)\n    state.atBottomStateChange(props.atBottomStateChange)\n    state.startReached(props.startReached)\n    state.endReached(props.endReached)\n    state.topItemCount(props.topItems || 0)\n    state.totalCount(props.totalCount)\n    props.initialItemCount && state.initialItemCount(props.initialItemCount)\n    state.itemsRendered(props.itemsRendered)\n    state.totalListHeightChanged(props.totalListHeightChanged)\n    state.followOutput(!!props.followOutput)\n    state.maxRangeSize(props.maxHeightCacheSize || Infinity)\n    state.rangeChanged(props.rangeChanged)\n    state.scrollSeekConfiguration(props.scrollSeek)\n    state.computeItemKey(props.computeItemKey || (key => key))\n    state.itemContainer(props.ItemContainer || 'div')\n    state.renderProp(props.item)\n    state.dataKey(props.dataKey)\n\n    return () => {\n      state.itemsRendered(undefined)\n      state.totalListHeightChanged(undefined)\n    }\n  }, [\n    state,\n    props.scrollingStateChange,\n    props.atBottomStateChange,\n    props.startReached,\n    props.endReached,\n    props.topItems,\n    props.totalCount,\n    props.initialItemCount,\n    props.itemsRendered,\n    props.totalListHeightChanged,\n    props.followOutput,\n    props.maxHeightCacheSize,\n    props.rangeChanged,\n    props.scrollSeek,\n    props.item,\n    props.ItemContainer,\n    props.computeItemKey,\n    props.dataKey,\n  ])\n\n  return (\n    <VirtuosoPresentation\n      contextValue={state}\n      style={props.style}\n      className={props.className}\n      header={props.header}\n      footer={props.footer}\n      itemHeight={props.itemHeight}\n      ScrollContainer={props.ScrollContainer}\n      HeaderContainer={props.HeaderContainer}\n      FooterContainer={props.FooterContainer}\n      ListContainer={props.ListContainer}\n      emptyComponent={props.emptyComponent}\n    />\n  )\n})\n\nVirtuoso.displayName = 'Virtuoso'\n","import * as React from 'react'\nimport { forwardRef, ReactElement, useImperativeHandle, useState, useEffect } from 'react'\nimport { TScrollLocation } from './EngineCommons'\nimport { TItemContainer, VirtuosoPresentation, VirtuosoProps } from './Virtuoso'\nimport { VirtuosoStore } from './VirtuosoStore'\n\ntype GroupedVirtuosoProps = Pick<VirtuosoProps, Exclude<keyof VirtuosoProps, 'totalCount' | 'topItems' | 'item'>> & {\n  groupCounts: number[]\n  group: (groupIndex: number) => ReactElement\n  item: (index: number, groupIndex?: number) => ReactElement\n  groupIndices?: (indices: number[]) => void\n  GroupContainer?: TItemContainer\n}\n\nexport interface GroupedVirtuosoMethods {\n  scrollToIndex(location: TScrollLocation): void\n}\n\nexport const GroupedVirtuoso = forwardRef<GroupedVirtuosoMethods, GroupedVirtuosoProps>((props, ref) => {\n  const [state] = useState(VirtuosoStore(props))\n  useImperativeHandle(\n    ref,\n    () => ({\n      scrollToIndex: (location: TScrollLocation) => {\n        state.scrollToIndex(location)\n      },\n    }),\n    [state]\n  )\n\n  useEffect(() => {\n    state.startReached(props.startReached)\n    state.endReached(props.endReached)\n    state.rangeChanged(props.rangeChanged)\n    state.atBottomStateChange(props.atBottomStateChange)\n    state.isScrolling(props.scrollingStateChange)\n    state.groupCounts(props.groupCounts)\n    state.groupIndices(props.groupIndices)\n    state.itemsRendered(props.itemsRendered)\n    state.totalListHeightChanged(props.totalListHeightChanged)\n    state.renderProp(props.item)\n    state.groupRenderProp(props.group)\n    state.itemContainer(props.ItemContainer || 'div')\n    state.groupContainer(props.GroupContainer || 'div')\n    state.scrollSeekConfiguration(props.scrollSeek)\n\n    return () => {\n      state.itemsRendered(undefined)\n      state.totalListHeightChanged(undefined)\n    }\n  }, [\n    state,\n    props.startReached,\n    props.endReached,\n    props.rangeChanged,\n    props.atBottomStateChange,\n    props.scrollingStateChange,\n    props.groupCounts,\n    props.groupIndices,\n    props.itemsRendered,\n    props.totalListHeightChanged,\n    props.item,\n    props.group,\n    props.GroupContainer,\n    props.ItemContainer,\n    props.scrollSeek,\n  ])\n\n  return (\n    <VirtuosoPresentation\n      contextValue={state}\n      style={props.style}\n      className={props.className}\n      header={props.header}\n      footer={props.footer}\n      itemHeight={props.itemHeight}\n      ScrollContainer={props.ScrollContainer}\n      HeaderContainer={props.HeaderContainer}\n      FooterContainer={props.FooterContainer}\n      ListContainer={props.ListContainer}\n    />\n  )\n})\n\nGroupedVirtuoso.displayName = 'GroupedVirtuoso'\n","import * as React from 'react'\nimport { subject, map, combineLatest, withLatestFrom, coldSubject } from './tinyrx'\nimport { makeInput, makeOutput } from './rxio'\nimport { TScrollLocation, TContainer, buildIsScrolling } from './EngineCommons'\nimport { ListRange, scrollSeekEngine } from './engines/scrollSeekEngine'\n\ntype GridDimensions = [\n  number, // container width,\n  number, // container height,\n  number | undefined, // item container width,\n  number | undefined, // item container height\n  number | undefined, // item content width\n  number | undefined // item content height\n]\n\ntype GridItemRange = [\n  number, // start index\n  number // end index\n]\n\ntype GridItemsRenderer = (\n  item: (index: number) => React.ReactElement,\n  itemClassName: string,\n  ItemContainer: TContainer,\n  computeItemKey: (index: number) => number\n) => React.ReactElement[]\n\nconst { ceil, floor, min, max } = Math\n\nconst hackFloor = (val: number) => (ceil(val) - val < 0.03 ? ceil(val) : floor(val))\n\nexport const VirtuosoGridEngine = (initialItemCount = 0) => {\n  const itemsRender = subject<any>(false)\n  const gridDimensions$ = subject<GridDimensions>([0, 0, undefined, undefined, undefined, undefined])\n  const totalCount$ = subject(0)\n  const scrollTop$ = subject(0)\n  const overscan$ = subject(0)\n  const itemRange$ = subject<GridItemRange>([0, max(initialItemCount - 1, 0)])\n  const remainingHeight$ = subject(0)\n  const listOffset$ = subject(0)\n  const scrollToIndex$ = coldSubject<TScrollLocation>()\n  const rangeChanged$ = coldSubject<ListRange>()\n\n  combineLatest(gridDimensions$, scrollTop$, overscan$, totalCount$)\n    .pipe(withLatestFrom(itemRange$))\n    .subscribe(\n      ([[[viewportWidth, viewportHeight, itemWidth, itemHeight], scrollTop, overscan, totalCount], itemRange]) => {\n        if (itemWidth === undefined || itemHeight === undefined) {\n          return\n        }\n\n        if (totalCount === 0) {\n          itemRange$.next([0, -1])\n          listOffset$.next(0)\n          rangeChanged$.next({ startIndex: 0, endIndex: -1 })\n          return\n        }\n\n        const [startIndex, endIndex] = itemRange\n        const itemsPerRow = hackFloor(viewportWidth / itemWidth)\n\n        const toRowIndex = (index: number, roundFunc = floor) => {\n          return roundFunc(index / itemsPerRow)\n        }\n\n        const updateRange = (down: boolean): void => {\n          const [topOverscan, bottomOverscan] = down ? [0, overscan] : [overscan, 0]\n\n          let startIndex = itemsPerRow * floor((scrollTop - topOverscan) / itemHeight)\n\n          let endIndex = itemsPerRow * ceil((scrollTop + viewportHeight + bottomOverscan) / itemHeight) - 1\n\n          endIndex = min(totalCount - 1, endIndex)\n          startIndex = min(endIndex, max(0, startIndex))\n\n          itemRange$.next([startIndex, endIndex])\n          listOffset$.next(toRowIndex(startIndex) * itemHeight)\n          rangeChanged$.next({ startIndex, endIndex })\n        }\n\n        const listTop = itemHeight * toRowIndex(startIndex)\n        const listBottom = itemHeight * toRowIndex(endIndex) + itemHeight\n\n        // totalCount has decreased, we have to re-render\n        if (totalCount < endIndex - 1) {\n          updateRange(true)\n          // user is scrolling up - list top is below the top edge of the viewport\n        } else if (listTop > scrollTop) {\n          updateRange(false)\n          // user is scrolling down - list bottom is above the bottom edge of the viewport\n        } else if (listBottom < scrollTop + viewportHeight) {\n          updateRange(true)\n        }\n\n        remainingHeight$.next(itemHeight * toRowIndex(totalCount - endIndex - 1, ceil))\n      }\n    )\n\n  const scrollTo$ = scrollToIndex$.pipe(\n    withLatestFrom(gridDimensions$, totalCount$),\n    map(([location, [viewportWidth, viewportHeight, itemWidth, itemHeight], totalCount]) => {\n      if (itemWidth === undefined || itemHeight === undefined) {\n        return { top: 0, behavior: 'auto' } as ScrollOptions\n      }\n\n      if (typeof location === 'number') {\n        location = { index: location, align: 'start' }\n      }\n\n      let { index, align = 'start', behavior = 'auto' } = location\n\n      index = Math.max(0, index, Math.min(totalCount - 1, index))\n\n      const itemsPerRow = hackFloor(viewportWidth / itemWidth)\n\n      let offset = floor(index / itemsPerRow) * itemHeight\n\n      if (align === 'end') {\n        offset = offset - viewportHeight + itemHeight\n      } else if (align === 'center') {\n        offset = Math.round(offset - viewportHeight / 2 + itemHeight / 2)\n      }\n\n      return { top: offset, behavior } as ScrollToOptions\n    })\n  )\n\n  const isScrolling$ = buildIsScrolling(scrollTop$)\n\n  const endReached$ = coldSubject<number>()\n  let currentEndIndex = 0\n\n  itemRange$.pipe(withLatestFrom(totalCount$)).subscribe(([[_, endIndex], totalCount]) => {\n    if (totalCount === 0) {\n      return\n    }\n\n    if (endIndex === totalCount - 1) {\n      if (currentEndIndex !== endIndex) {\n        currentEndIndex = endIndex\n        endReached$.next(endIndex)\n      }\n    }\n  })\n\n  const { isSeeking$, scrollSeekConfiguration$ } = scrollSeekEngine({\n    scrollTop$,\n    isScrolling$,\n    rangeChanged$,\n  })\n\n  combineLatest(itemRange$, isSeeking$, scrollSeekConfiguration$, gridDimensions$)\n    .pipe(\n      map(([[startIndex, endIndex], renderPlaceholder, scrollSeek, [_, __, ___, ____, _____, itemHeight]]) => {\n        const render: GridItemsRenderer = (item, itemClassName, ItemContainer, computeItemKey) => {\n          const items = []\n          for (let index = startIndex; index <= endIndex; index++) {\n            const key = computeItemKey(index)\n            let children: React.ReactElement\n\n            if (scrollSeek && renderPlaceholder && itemHeight) {\n              children = React.createElement(scrollSeek.placeholder, {\n                height: itemHeight,\n                index,\n              })\n            } else {\n              children = item(index)\n            }\n\n            items.push(\n              React.createElement(\n                ItemContainer,\n                {\n                  key,\n                  className: itemClassName,\n                },\n                children\n              )\n            )\n          }\n\n          return items\n        }\n        return { render }\n      })\n    )\n    .subscribe(itemsRender.next)\n\n  return {\n    gridDimensions: makeInput(gridDimensions$),\n    totalCount: makeInput(totalCount$),\n    scrollTop: makeInput(scrollTop$),\n    overscan: makeInput(overscan$),\n    scrollToIndex: makeInput(scrollToIndex$),\n    scrollSeekConfiguration: makeInput(scrollSeekConfiguration$),\n\n    itemsRender: makeOutput(itemsRender),\n\n    itemRange: makeOutput(itemRange$),\n    remainingHeight: makeOutput(remainingHeight$),\n    listOffset: makeOutput(listOffset$),\n    scrollTo: makeOutput(scrollTo$),\n    isScrolling: makeOutput(isScrolling$),\n    endReached: makeOutput(endReached$),\n    rangeChanged: makeOutput(rangeChanged$),\n  }\n}\n","import * as React from 'react'\nimport { CSSProperties, ReactElement } from 'react'\nimport { TSubscriber } from './tinyrx'\nimport { VirtuosoGridEngine } from './VirtuosoGridEngine'\nimport { VirtuosoScroller, TScrollContainer } from './VirtuosoScroller'\nimport { useOutput, useSize } from './Utils'\nimport { viewportStyle } from './Style'\nimport { TScrollLocation, TContainer } from './EngineCommons'\nimport { ListRange, ScrollSeekConfiguration } from './engines/scrollSeekEngine'\n\nexport interface VirtuosoGridProps {\n  totalCount: number\n  overscan?: number\n  item: (index: number) => ReactElement\n  style?: CSSProperties\n  className?: string\n  ScrollContainer?: TScrollContainer\n  ListContainer?: TContainer\n  ItemContainer?: TContainer\n  listClassName?: string\n  itemClassName?: string\n  scrollingStateChange?: (isScrolling: boolean) => void\n  endReached?: (index: number) => void\n  initialItemCount?: number\n  rangeChanged?: TSubscriber<ListRange>\n  computeItemKey?: (index: number) => number\n  scrollSeek?: ScrollSeekConfiguration\n}\n\ntype VirtuosoGridState = ReturnType<typeof VirtuosoGridEngine>\n\ntype VirtuosoGridFCProps = Omit<VirtuosoGridProps, 'overscan' | 'totalCount'> & { engine: VirtuosoGridState }\n\nexport class VirtuosoGrid extends React.PureComponent<VirtuosoGridProps, VirtuosoGridState> {\n  public state = VirtuosoGridEngine(this.props.initialItemCount)\n\n  public static getDerivedStateFromProps(props: VirtuosoGridProps, engine: VirtuosoGridState) {\n    engine.overscan(props.overscan || 0)\n    engine.totalCount(props.totalCount)\n    engine.isScrolling(props.scrollingStateChange)\n    engine.endReached(props.endReached)\n    engine.rangeChanged(props.rangeChanged)\n    engine.scrollSeekConfiguration(props.scrollSeek)\n    return null\n  }\n\n  public scrollToIndex(location: TScrollLocation) {\n    this.state.scrollToIndex(location)\n  }\n\n  public render() {\n    return <VirtuosoGridFC {...this.props} engine={this.state} />\n  }\n}\n\nconst VirtuosoGridFC: React.FC<VirtuosoGridFCProps> = ({\n  ScrollContainer,\n  ItemContainer = 'div',\n  ListContainer = 'div',\n  className,\n  item,\n  itemClassName = 'virtuoso-grid-item',\n  listClassName = 'virtuoso-grid-list',\n  engine,\n  style = { height: '100%' },\n  computeItemKey = key => key,\n}) => {\n  const { listOffset, remainingHeight, gridDimensions, scrollTo, scrollTop, itemsRender } = engine\n\n  const fillerHeight = useOutput<number>(remainingHeight, 0)\n  const translate = useOutput<number>(listOffset, 0)\n  const listStyle = { paddingTop: `${translate}px`, paddingBottom: `${fillerHeight}px` }\n\n  const render = useOutput(itemsRender, false)\n\n  const viewportCallbackRef = useSize(({ element, width, height }) => {\n    const firstItem = element.firstChild!.firstChild as HTMLElement\n    const firstItemContent = firstItem!.firstChild as HTMLElement\n    gridDimensions([\n      width,\n      height,\n      firstItem.offsetWidth,\n      firstItem.offsetHeight,\n      firstItemContent.offsetWidth,\n      firstItemContent.offsetHeight,\n    ])\n  })\n\n  return (\n    <VirtuosoScroller\n      style={style}\n      ScrollContainer={ScrollContainer}\n      className={className}\n      scrollTo={scrollTo}\n      scrollTop={scrollTop}\n    >\n      <div ref={viewportCallbackRef} style={viewportStyle}>\n        {React.createElement(\n          ListContainer,\n          {\n            style: listStyle,\n            className: listClassName,\n          },\n          render.render(item, itemClassName, ItemContainer, computeItemKey)\n        )}\n      </div>\n    </VirtuosoScroller>\n  )\n}\n"],"names":["VirtuosoContext","createContext","undefined","combineOperators","operators","length","value","subscriber","acc","slice","reverse","forEach","operator","prevCallback","buildPipe","subscribe","pipe","observable","source","val","subject","initial","distinct","subscribers","next","newVal","push","filter","sub","coldSubject","combineLatest","sources","called","Array","fill","values","publish","every","isCalled","index","map","mapTo","_","done","skip","times","predicate","duc","comparator","current","debounceTime","time","timeout","clearTimeout","setTimeout","throttleTime","scan","scanner","initialValue","prevVal","withLatestFrom","buildIsScrolling","scrollTop$","isScrolling$","adjustForPrependedItemsEngine","offsetList$","scrollTo$","adjustForPrependedItems$","adjustmentInProgress$","count","offsetList","scrollTop","inProgress","empty","adjustForPrependedItems","top","getDefaultSize","followOutputEngine","scrollToIndex$","scrolledToBottom$","totalCount$","followOutput$","followOutput","totalCount","scrolledToBottom","align","behavior","NilNode","rebalance","adjust","shift","remove","find","findWith","findMax","Infinity","findMaxValue","insert","key","NonNilNode","level","walkWithin","walk","ranges","rangesWithin","isSingle","isInvariant","keys","NIL_NODE","Object","freeze","UnreachableCaseError","Error","left","right","amount","clone","last","lastKey","lastValue","deleteLast","callback","result","rightKey","rightValue","start","end","concat","args","skew","split","rl","rightLevel","toRanges","startIndex","endIndex","nodes","first","i","nextNode","AATree","root","defaultValue","adjustedStart","StubIndexTransposer","transpose","items","item","groupIndex","offset","size","transposedIndex","type","GroupIndexTransposer","counts","reduce","groupCount","tree","total","groupMatch","groupIndices","groupCountEngine","transposer$","stickyItems$","groupCounts$","groupIndices$","transposer","getListTop","listEngine","overscan","defaultItemHeight","viewportHeight$","topListHeight$","headerHeight$","footerHeight$","minListIndex$","scrolledToTopMostItem$","totalHeight$","listHeight$","startReached$","endReached$","list$","constrainedScrollTop$","totalHeight","viewportHeight","Math","max","min","topListHeight","listHeight","headerHeight","footerHeight","minIndex","scrolledToTopMostItem","itemLength","listTop","listBottom","maxIndex","indexOutOfAllowedRange","endOffset","range","startOffset","listOffset$","currentEndIndex","maxRangeSizeEngine","scheduledReadjust$","maxRangeSize$","maxRangeSize","list","configureMaxRangeSize","scrollTo","offsetOf","OffsetList","rangeTree","offsetTree","nanIndices","initialTopMostItemIndex","nanFound","rangeSize","isNaN","create","fromTree","rangeSizeExceededCallback","indexOf","groupSize","nanIndex","overlapingRanges","some","firstPassDone","shouldInsert","rangeStart","rangeEnd","rangeValue","insertSpots","spotIndexes","spot","NaN","offsetRange","itemAt","indexRange","rangeOffset","rangeIndex","floor","getOffsets","indices","IndexList","setInitialIndex","topMostItemIndex","maxRangeSizeExceededCallback","initialItemCountEngine","itemHeights$","initialItemCount$","pendingRenderAfterInitial$","unsubscribeInitial","dummyItemHeight","stickyItemsEngine","topList$","stickyItemsIndexList$","stickyItems","params","stickyItemsIndexList","topList","currentStickyItem","offsetListEngine","itemHeight","heightsChanged$","initialOffsetList","heights","pendingRenderAfterInitial","newList","scrolledToBottomEngine","notAtBottom","scrollSeekEngine","range$","rangeChanged$","scrollVelocity$","isSeeking$","scrollSeekConfiguration$","prev","config","speed","isSeeking","exit","enter","velocity","change","initialTopMostItemIndexEngine","scrollToIndexEngine","scrollToIndexRequestPending$","scrollTopReportedAfterScrollToIndex$","changed","location","round","scrollTopReported","scrollToIndexRequestPending","scrollToIndex","topItemCountEngine","topItemCount$","topItemCount","topListEngine","makeOutput","unsubscribe","makeInput","VirtuosoStore","stickyItemsOffset$","MAX_OFFSET_HEIGHT","domTotalHeight$","scrollTopMultiplier$","domTotalHeight","domScrollTop$","domListOffset$","multiplier","domScrollTop","computeItemKey$","itemIndex","renderProp$","_groupIndex","groupRenderProp$","itemContainer$","groupContainer$","itemRender$","dataKey$","Symbol","render","groupRender","scrollSeek","computeItemKey","ItemContainer","GroupContainer","renderPlaceholder","itemProps","React","children","placeholder","height","groupCounts","itemHeights","initialItemCount","scrollSeekConfiguration","renderProp","groupRenderProp","itemContainer","groupContainer","dataKey","itemRender","scrollVelocity","itemsRendered","listOffset","startReached","endReached","atBottomStateChange","totalListHeightChanged","rangeChanged","isScrolling","stickyItemsOffset","viewportStyle","position","width","useHeight","input","onMount","onResize","ref","useRef","animationFrameID","observer","ResizeObserver","entries","newHeight","contentRect","window","requestAnimationFrame","element","target","document","body","contains","callbackRef","elRef","observe","unobserve","useEffect","cancelAnimationFrame","callbackToValue","output","useOutput","useState","setValue","useSize","currentSize","simpleMemoize","func","WEBKIT_STICKY","STICKY","positionStickyCssValue","node","createElement","style","VirtuosoFiller","VirtuosoList","emptyComponent","useContext","topItems","renderedItems","topOffset","renderedTopItemIndices","marginTop","zIndex","props","scrollerStyle","overflowY","WebkitOverflowScrolling","outline","DefaultScrollContainer","className","reportScrollTop","smoothScrollTarget","currentScrollTop","onScroll","useCallback","e","theRef","addEventListener","passive","removeEventListener","tabIndex","VirtuosoScroller","ScrollContainer","DefaultHeaderContainer","headerRef","DefaultFooterContainer","footerRef","DefaultListContainer","listRef","VirtuosoHeader","header","HeaderContainer","headerCallbackRef","VirtuosoFooter","footer","FooterContainer","footerCallbackRef","getHeights","results","len","child","dataset","parseInt","knownSize","offsetHeight","lastResult","ListWrapper","fixedItemHeight","ListContainer","translate","listCallbackRef","measuredItemHeights","VirtuosoView","fillerHeight","st","viewportCallbackRef","DEFAULT_STYLE","VirtuosoPresentation","contextValue","Provider","Virtuoso","forwardRef","state","useImperativeHandle","scrollingStateChange","maxHeightCacheSize","displayName","GroupedVirtuoso","group","ceil","hackFloor","VirtuosoGridEngine","itemsRender","gridDimensions$","overscan$","itemRange$","remainingHeight$","viewportWidth","itemWidth","itemRange","itemsPerRow","toRowIndex","roundFunc","updateRange","down","topOverscan","bottomOverscan","itemClassName","gridDimensions","remainingHeight","VirtuosoGrid","getDerivedStateFromProps","engine","VirtuosoGridFC","listClassName","listStyle","paddingTop","paddingBottom","firstItem","firstChild","firstItemContent","offsetWidth"],"mappings":"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"}